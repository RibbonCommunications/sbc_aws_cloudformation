{
    "AWSTemplateFormatVersion" : "2010-09-09",

    "Description" : "AWS CloudFormation Template to setup and deploy a stand-alone vSBC instance", 

    "Parameters" : {

      "AMIID" : {
        "Description" : "AMI ID of SBC : ami-xxxxxxxx",
        "Type" : "AWS::EC2::Image::Id",
        "MaxLength": "21",
        "Default" : "ami-3f22b428",
        "AllowedPattern" : "ami-[a-z0-9]*",
        "ConstraintDescription" : "Must be a valid AMI ID"
      },

      "LinuxAdminSshKey": {
        "Description" : "Name of an existing EC2 KeyPair to enable SSH access to the instance with linuxadmin user",
        "Type": "AWS::EC2::KeyPair::KeyName",
        "ConstraintDescription" : "Must be the name of an existing EC2 KeyPair."
      },

      "AdminSshKey": {
        "Description" : "Enter Public Key to enable SSH access to CLI via admin user",
        "Type": "String",
        "Default" : "ssh-rsa <key>",
        "AllowedPattern" : "ssh-rsa .*",
        "ConstraintDescription" : "Must be a valid public key - Format: ssh-rsa <key>."
      },

      "CERole" : {
        "Description" : "SBC Configured CE Role",
        "Type" : "String",
        "Default" : "ACTIVE",
        "AllowedValues" : ["ACTIVE", "STANDBY"],
        "ConstraintDescription" : "Must be a valid SBC CE Role."
      },

      "SBCPersonality" : {
        "Description" : "SBC Personality type",
        "Type" : "String",
        "Default" : "isbc",
        "AllowedValues" : [ "isbc", "ssbc", "msbc" ],
        "ConstraintDescription" : "Must be a valid SBC Personality type."
      },

      "InstanceName" : {
        "Description" : "CE name of the instance",
        "Type" : "String",
        "Default" : "vsbc1",
        "MaxLength" : "63",
        "AllowedPattern" : "^[A-Za-z]{1}[-A-Za-z0-9.]*[A-Za-z0-9]{1}$",
        "ConstraintDescription" : "Enter valid ceName(instance name). Regex: ^[A-Za-z]{1}[-A-Za-z0-9.]*[A-Za-z0-9]{1}$"
      },

      "SystemName" : {
        "Description" : "System name",
        "Type" : "String",
        "Default" : "vsbcSystem",
        "MaxLength" : "26",
        "AllowedPattern" : "^[A-Za-z]{1}[-A-Za-z0-9]*[A-Za-z0-9]{1}$",
        "ConstraintDescription" : "Enter valid system Name.  Regex: ^[A-Za-z]{1}[-A-Za-z0-9]*[A-Za-z0-9]{1}$ "
      },

      "VpcId" : {
        "Type" : "AWS::EC2::VPC::Id",
        "Description" : "Select a VPC with four subnets: mgt0, ha0, pkt0 and pkt1"
      },

      "InstanceType" : {
        "Description" : "EC2 instance type",
        "Type" : "String",
        "Default" : "m5.xlarge",
        "AllowedValues" : ["m5.xlarge", "m5.2xlarge", "c5.2xlarge", "c5.4xlarge","c5.9xlarge","c5n.2xlarge","c5n.4xlarge","c5n.9xlarge", "p3.2xlarge", "g3.4xlarge"],
        "ConstraintDescription" : "Must be a valid EC2 instance type"
      },

      "SecurityGrpMgt0" : {
        "Description" : "Select security Group for mgt0",
        "Type" : "AWS::EC2::SecurityGroup::Id"
      },

      "SecurityGrpHa0" : {
        "Description" : "Select security Group for ha0",
        "Type" : "AWS::EC2::SecurityGroup::Id"
      },

      "SecurityGrpPkt0" : {
        "Description" : "Select security Group for pkt0",
        "Type" : "AWS::EC2::SecurityGroup::Id"
      },

      "SecurityGrpPkt1" : {
        "Description" : "Select security Group for pkt1",
        "Type" : "AWS::EC2::SecurityGroup::Id"
      },

      "SubnetIdMgt0" : {
        "Description" : "SubnetId of an existing subnet in your Virtual Private Cloud (VPC) for Mgt0",
        "Type" : "AWS::EC2::Subnet::Id"
      },

      "SubnetIdHA0" : {
        "Description" : "SubnetId of an existing subnet in your Virtual Private Cloud (VPC) for HA0",
        "Type" : "AWS::EC2::Subnet::Id"
      },

      "SubnetIdPkt0" : {
        "Description" : "SubnetId of an existing subnet in your Virtual Private Cloud (VPC) for Pkt0",
        "Type" : "AWS::EC2::Subnet::Id"
      },

      "SubnetIdPkt1" : {
        "Description" : "SubnetId of an existing subnet in your Virtual Private Cloud (VPC) for Pkt1",
        "Type" : "AWS::EC2::Subnet::Id"
      },

      "NumberOfAlternateIPOnPkt0" : {
        "Description" : "Enter Number of IPs required on PKT0 port",
        "Type" : "Number",
        "Default"  : "1",
        "MaxValue" : "14",
        "MinValue" : "0"
      },

      "NumberOfAlternateIPOnPkt1" : {
        "Description" : "Enter Number of IPs required on PKT1 port",
        "Type" : "Number",
        "Default"  : "1",
        "MaxValue" : "14",
        "MinValue" : "0"
      },

      "NumberOfEIPOnPkt0" : {
        "Description" : "Enter Number of EIP required on PKT0 port",
        "Type" : "Number",
        "Default"  : "0",
        "MaxValue" : "14",
        "MinValue" : "0"
      },

      "NumberOfEIPOnPkt1" : {
        "Description" : "Enter Number of EIP required on PKT1 port",
        "Type" : "Number",
        "Default"  : "0",
        "MaxValue" : "14",
        "MinValue" : "0"
      },

      "EipAssociationOnMgt" : {
        "Description" : "Link Mgt0 interface with an EIP to login to the instance from public network",
        "Type" : "String",
        "Default"  : "No",
        "AllowedValues" : ["No", "Yes"]
      },

      "ReveseNatEnablePkt0" : {
        "Description" : "Enable the Reverse NAT functionality for pkt0 interface",
        "Type" : "String",
        "Default"  : "False",
        "AllowedValues" : ["True", "False"]
      },

      "ReveseNatEnablePkt1" : {
        "Description" : "Enable the Reverse NAT functionality for pkt1 interface",
        "Type" : "String",
        "Default"  : "False",
        "AllowedValues" : ["True", "False"]
      },

      "Tenancy" : {
          "Description" : "Tenancy attribute for instance",
          "Type" : "String",
          "Default" : "default",
          "AllowedValues" : ["default", "dedicated"]
      },

      "PlacementId" : {
          "Description" : "PlacementGroup to launch instance(Optional)",
          "Type" : "String",
          "Default" : ""
      },

      "VolumeType" : {
        "Description" : "Select Type of Volume for SBC",
        "Type" : "String",
        "Default"  : "gp2",
	"AllowedValues" : ["gp2", "io1"]
      },

      "IOPS" : {
        "Description" : "Enter IOPS reservation for io1 type EBS volume [<= 1950], for gp2 EBS volumes this value is ignored by template.",
        "Type" : "Number",
        "Default"  : "1950",
        "MaxValue" : "1950"
      },

      "VolumeSize" : {
        "Description" : "Enter size of disk in GiB. Minimum disk required is 65 GiB",
        "Type" : "Number",
        "Default"  : "65",
        "MinValue" : "65",
        "MaxValue" : "1000"
      },

      "ThirdPartyCpus" : {
        "Description" : "Enter number of CPUs to be reserved for use with third party apps.",
        "Type" : "Number",
        "Default" : "0",
        "MinValue" : "0",
        "MaxValue" : "4"
      },

      "ThirdPartyMem" : {
        "Description" : "Enter how many MB of memory to allow for use with third party apps.",
        "Type" : "Number",
        "Default" : "0",
        "MinValue" : "0",
        "MaxValue" : "4096"
      }
    },


    "Conditions" : {
      "VolumeTypeIO1"      : { "Fn::Equals" : [{"Ref" : "VolumeType"}, "io1"] },

      "NameValidationFailed"  : {"Fn::Equals" : [{"Ref" : "SystemName"}, {"Ref" : "InstanceName"}]},
      "NameValidationPassed" : {"Fn::Not" : [ {"Condition": "NameValidationFailed"} ]},

      "EipOnMgt"           : { "Fn::And" : [ { "Fn::Equals" : [{"Ref" : "EipAssociationOnMgt"}, "Yes" ] }, {"Condition": "NameValidationPassed"} ]},

      "EipOnPkt0_01" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt0"}, "1"]},
      "EipOnPkt0_02" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt0"}, "2"]},
      "EipOnPkt0_03" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt0"}, "3"]},
      "EipOnPkt0_04" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt0"}, "4"]},
      "EipOnPkt0_05" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt0"}, "5"]},
      "EipOnPkt0_06" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt0"}, "6"]},
      "EipOnPkt0_07" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt0"}, "7"]},
      "EipOnPkt0_08" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt0"}, "8"]},
      "EipOnPkt0_09" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt0"}, "9"]},
      "EipOnPkt0_10" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt0"}, "10"]},
      "EipOnPkt0_11" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt0"}, "11"]},
      "EipOnPkt0_12" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt0"}, "12"]},
      "EipOnPkt0_13" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt0"}, "13"]},
      "EipOnPkt0_14" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt0"}, "14"]},

      "AssociateEipOnPkt0_01" : { "Fn::And" : [ { "Fn::Or" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt0_01"}, {"Condition": "EipOnPkt0_02"}, {"Condition": "EipOnPkt0_03"}, {"Condition": "EipOnPkt0_04"}, {"Condition": "EipOnPkt0_05"}, {"Condition": "EipOnPkt0_06"}, {"Condition": "EipOnPkt0_07"}, {"Condition": "EipOnPkt0_08"}, {"Condition": "EipOnPkt0_09"}, {"Condition": "EipOnPkt0_10"} ] }, {"Condition": "EipOnPkt0_11"}, {"Condition": "EipOnPkt0_12"}, {"Condition": "EipOnPkt0_13"}, {"Condition": "EipOnPkt0_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt0_02" : { "Fn::And" : [ { "Fn::Or" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt0_02"}, {"Condition": "EipOnPkt0_03"}, {"Condition": "EipOnPkt0_04"}, {"Condition": "EipOnPkt0_05"}, {"Condition": "EipOnPkt0_06"}, {"Condition": "EipOnPkt0_07"}, {"Condition": "EipOnPkt0_08"}, {"Condition": "EipOnPkt0_09"}, {"Condition": "EipOnPkt0_10"} ] }, {"Condition": "EipOnPkt0_11"}, {"Condition": "EipOnPkt0_12"}, {"Condition": "EipOnPkt0_13"}, {"Condition": "EipOnPkt0_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt0_03" : { "Fn::And" : [ { "Fn::Or" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt0_03"}, {"Condition": "EipOnPkt0_04"}, {"Condition": "EipOnPkt0_05"}, {"Condition": "EipOnPkt0_06"}, {"Condition": "EipOnPkt0_07"}, {"Condition": "EipOnPkt0_08"}, {"Condition": "EipOnPkt0_09"}, {"Condition": "EipOnPkt0_10"} ] }, {"Condition": "EipOnPkt0_11"}, {"Condition": "EipOnPkt0_12"}, {"Condition": "EipOnPkt0_13"}, {"Condition": "EipOnPkt0_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt0_04" : { "Fn::And" : [ { "Fn::Or" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt0_04"}, {"Condition": "EipOnPkt0_05"}, {"Condition": "EipOnPkt0_06"}, {"Condition": "EipOnPkt0_07"}, {"Condition": "EipOnPkt0_08"}, {"Condition": "EipOnPkt0_09"}, {"Condition": "EipOnPkt0_10"} ] }, {"Condition": "EipOnPkt0_11"}, {"Condition": "EipOnPkt0_12"}, {"Condition": "EipOnPkt0_13"}, {"Condition": "EipOnPkt0_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt0_05" : { "Fn::And" : [ { "Fn::Or" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt0_05"}, {"Condition": "EipOnPkt0_06"}, {"Condition": "EipOnPkt0_07"}, {"Condition": "EipOnPkt0_08"}, {"Condition": "EipOnPkt0_09"}, {"Condition": "EipOnPkt0_10"} ] }, {"Condition": "EipOnPkt0_11"}, {"Condition": "EipOnPkt0_12"}, {"Condition": "EipOnPkt0_13"}, {"Condition": "EipOnPkt0_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt0_06" : { "Fn::And" : [ { "Fn::Or" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt0_06"}, {"Condition": "EipOnPkt0_07"}, {"Condition": "EipOnPkt0_08"}, {"Condition": "EipOnPkt0_09"}, {"Condition": "EipOnPkt0_10"} ] }, {"Condition": "EipOnPkt0_11"}, {"Condition": "EipOnPkt0_12"}, {"Condition": "EipOnPkt0_13"}, {"Condition": "EipOnPkt0_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt0_07" : { "Fn::And" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt0_07"}, {"Condition": "EipOnPkt0_08"}, {"Condition": "EipOnPkt0_09"}, {"Condition": "EipOnPkt0_10"}, {"Condition": "EipOnPkt0_11"}, {"Condition": "EipOnPkt0_12"}, {"Condition": "EipOnPkt0_13"}, {"Condition": "EipOnPkt0_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt0_08" : { "Fn::And" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt0_08"}, {"Condition": "EipOnPkt0_09"}, {"Condition": "EipOnPkt0_10"}, {"Condition": "EipOnPkt0_11"}, {"Condition": "EipOnPkt0_12"}, {"Condition": "EipOnPkt0_13"}, {"Condition": "EipOnPkt0_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt0_09" : { "Fn::And" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt0_09"}, {"Condition": "EipOnPkt0_10"}, {"Condition": "EipOnPkt0_11"}, {"Condition": "EipOnPkt0_12"}, {"Condition": "EipOnPkt0_13"}, {"Condition": "EipOnPkt0_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt0_10" : { "Fn::And" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt0_10"}, {"Condition": "EipOnPkt0_11"}, {"Condition": "EipOnPkt0_12"}, {"Condition": "EipOnPkt0_13"}, {"Condition": "EipOnPkt0_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt0_11" : { "Fn::And" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt0_11"}, {"Condition": "EipOnPkt0_12"}, {"Condition": "EipOnPkt0_13"}, {"Condition": "EipOnPkt0_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt0_12" : { "Fn::And" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt0_12"}, {"Condition": "EipOnPkt0_13"}, {"Condition": "EipOnPkt0_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt0_13" : { "Fn::And" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt0_13"}, {"Condition": "EipOnPkt0_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt0_14" : { "Fn::And" : [{"Condition": "EipOnPkt0_14"}, {"Condition": "NameValidationPassed"} ]},

      "EipOnPkt1_01" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt1"}, "1"]},
      "EipOnPkt1_02" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt1"}, "2"]},
      "EipOnPkt1_03" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt1"}, "3"]},
      "EipOnPkt1_04" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt1"}, "4"]},
      "EipOnPkt1_05" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt1"}, "5"]},
      "EipOnPkt1_06" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt1"}, "6"]},
      "EipOnPkt1_07" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt1"}, "7"]},
      "EipOnPkt1_08" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt1"}, "8"]},
      "EipOnPkt1_09" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt1"}, "9"]},
      "EipOnPkt1_10" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt1"}, "10"]},
      "EipOnPkt1_11" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt1"}, "11"]},
      "EipOnPkt1_12" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt1"}, "12"]},
      "EipOnPkt1_13" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt1"}, "13"]},
      "EipOnPkt1_14" : { "Fn::Equals" : [{"Ref" : "NumberOfEIPOnPkt1"}, "14"]},

      "AssociateEipOnPkt1_01" : { "Fn::And" : [ { "Fn::Or" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt1_01"}, {"Condition": "EipOnPkt1_02"}, {"Condition": "EipOnPkt1_03"}, {"Condition": "EipOnPkt1_04"}, {"Condition": "EipOnPkt1_05"}, {"Condition": "EipOnPkt1_06"}, {"Condition": "EipOnPkt1_07"}, {"Condition": "EipOnPkt1_08"}, {"Condition": "EipOnPkt1_09"}, {"Condition": "EipOnPkt1_10"} ] }, {"Condition": "EipOnPkt1_11"}, {"Condition": "EipOnPkt1_12"}, {"Condition": "EipOnPkt1_13"}, {"Condition": "EipOnPkt1_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt1_02" : { "Fn::And" : [ { "Fn::Or" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt1_02"}, {"Condition": "EipOnPkt1_03"}, {"Condition": "EipOnPkt1_04"}, {"Condition": "EipOnPkt1_05"}, {"Condition": "EipOnPkt1_06"}, {"Condition": "EipOnPkt1_07"}, {"Condition": "EipOnPkt1_08"}, {"Condition": "EipOnPkt1_09"}, {"Condition": "EipOnPkt1_10"} ] }, {"Condition": "EipOnPkt1_11"}, {"Condition": "EipOnPkt1_12"}, {"Condition": "EipOnPkt1_13"}, {"Condition": "EipOnPkt1_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt1_03" : { "Fn::And" : [ { "Fn::Or" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt1_03"}, {"Condition": "EipOnPkt1_04"}, {"Condition": "EipOnPkt1_05"}, {"Condition": "EipOnPkt1_06"}, {"Condition": "EipOnPkt1_07"}, {"Condition": "EipOnPkt1_08"}, {"Condition": "EipOnPkt1_09"}, {"Condition": "EipOnPkt1_10"} ] }, {"Condition": "EipOnPkt1_11"}, {"Condition": "EipOnPkt1_12"}, {"Condition": "EipOnPkt1_13"}, {"Condition": "EipOnPkt1_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt1_04" : { "Fn::And" : [ { "Fn::Or" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt1_04"}, {"Condition": "EipOnPkt1_05"}, {"Condition": "EipOnPkt1_06"}, {"Condition": "EipOnPkt1_07"}, {"Condition": "EipOnPkt1_08"}, {"Condition": "EipOnPkt1_09"}, {"Condition": "EipOnPkt1_10"} ] }, {"Condition": "EipOnPkt1_11"}, {"Condition": "EipOnPkt1_12"}, {"Condition": "EipOnPkt1_13"}, {"Condition": "EipOnPkt1_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt1_05" : { "Fn::And" : [ { "Fn::Or" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt1_05"}, {"Condition": "EipOnPkt1_06"}, {"Condition": "EipOnPkt1_07"}, {"Condition": "EipOnPkt1_08"}, {"Condition": "EipOnPkt1_09"}, {"Condition": "EipOnPkt1_10"} ] }, {"Condition": "EipOnPkt1_11"}, {"Condition": "EipOnPkt1_12"}, {"Condition": "EipOnPkt1_13"}, {"Condition": "EipOnPkt1_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt1_06" : { "Fn::And" : [ { "Fn::Or" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt1_06"}, {"Condition": "EipOnPkt1_07"}, {"Condition": "EipOnPkt1_08"}, {"Condition": "EipOnPkt1_09"}, {"Condition": "EipOnPkt1_10"} ] }, {"Condition": "EipOnPkt1_11"}, {"Condition": "EipOnPkt1_12"}, {"Condition": "EipOnPkt1_13"}, {"Condition": "EipOnPkt1_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt1_07" : { "Fn::And" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt1_07"}, {"Condition": "EipOnPkt1_08"}, {"Condition": "EipOnPkt1_09"}, {"Condition": "EipOnPkt1_10"}, {"Condition": "EipOnPkt1_11"}, {"Condition": "EipOnPkt1_12"}, {"Condition": "EipOnPkt1_13"}, {"Condition": "EipOnPkt1_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt1_08" : { "Fn::And" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt1_08"}, {"Condition": "EipOnPkt1_09"}, {"Condition": "EipOnPkt1_10"}, {"Condition": "EipOnPkt1_11"}, {"Condition": "EipOnPkt1_12"}, {"Condition": "EipOnPkt1_13"}, {"Condition": "EipOnPkt1_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt1_09" : { "Fn::And" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt1_09"}, {"Condition": "EipOnPkt1_10"}, {"Condition": "EipOnPkt1_11"}, {"Condition": "EipOnPkt1_12"}, {"Condition": "EipOnPkt1_13"}, {"Condition": "EipOnPkt1_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt1_10" : { "Fn::And" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt1_10"}, {"Condition": "EipOnPkt1_11"}, {"Condition": "EipOnPkt1_12"}, {"Condition": "EipOnPkt1_13"}, {"Condition": "EipOnPkt1_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt1_11" : { "Fn::And" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt1_11"}, {"Condition": "EipOnPkt1_12"}, {"Condition": "EipOnPkt1_13"}, {"Condition": "EipOnPkt1_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt1_12" : { "Fn::And" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt1_12"}, {"Condition": "EipOnPkt1_13"}, {"Condition": "EipOnPkt1_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt1_13" : { "Fn::And" : [{ "Fn::Or" : [ {"Condition": "EipOnPkt1_13"}, {"Condition": "EipOnPkt1_14"}] }, {"Condition": "NameValidationPassed"} ]},
      "AssociateEipOnPkt1_14" : { "Fn::And" : [{"Condition": "EipOnPkt1_14"}, {"Condition": "NameValidationPassed"} ]}
    },

  "Metadata" : {
    "AWS::CloudFormation::Interface" : {
      "ParameterGroups" : [{
        "Label" : {"default": "Network configuration"},
        "Parameters" : ["VpcId", "SecurityGrpMgt0", "SecurityGrpHa0", "SecurityGrpPkt0", "SecurityGrpPkt1", "SubnetIdMgt0", "SubnetIdHA0", "SubnetIdPkt0", "SubnetIdPkt1"]
      },
      {
        "Label" : {"default": "System configuration"},
        "Parameters" : ["AMIID", "CERole", "SBCPersonality", "InstanceName", "SystemName", "InstanceType"]
      },
      {
        "Label" : {"default": "Storage configuration"},
        "Parameters" : ["VolumeType", "IOPS", "VolumeSize"]
      },
      {
        "Label" : {"default": "Secondary IP configuration for PKT0 and PKT1"},
        "Parameters" : ["NumberOfAlternateIPOnPkt0", "NumberOfAlternateIPOnPkt1"]
      },
      {
        "Label" : {"default": "Elastic IP configuration"},
        "Parameters" : ["NumberOfEIPOnPkt0", "NumberOfEIPOnPkt1", "EipAssociationOnMgt"]
      },
      {
        "Label" : {"default": "Reverse NAT configuration"},
        "Parameters" : ["ReveseNatEnablePkt0", "ReveseNatEnablePkt1"]
      },
      {
        "Label" : {"default": "Security configuration"},
        "Parameters" : ["LinuxAdminSshKey","AdminSshKey"]
      },
      {
        "Label" : {"default": "Placement of Instance"},
        "Parameters" : ["Tenancy", "PlacementId"]
      },
      {
        "Label": {"default": "Third Party Applications Provisioning"},
        "Parameters" : ["ThirdPartyCpus", "ThirdPartyMem"]
      }

      ]
    }
  },
    
  "Resources" : {

      "mgtXfaceA" : {
        "Type" : "AWS::EC2::NetworkInterface",
        "Condition" : "NameValidationPassed",
        "Properties" : {
          "SubnetId" : {"Ref": "SubnetIdMgt0" } ,
          "Description" : {"Fn::Join" : [ "-", [ { "Ref" : "AWS::StackName" },"mgt0" ] ]},
          "GroupSet" : [ {"Ref" : "SecurityGrpMgt0"} ],
          "SourceDestCheck" : "true",
          "Tags" : [ {"Key" : "Name", "Value" : {"Fn::Join" : [ "-", [ { "Ref" : "AWS::StackName" }, "mgt0" ] ]} }]
        }
      },


      "haXfaceA" : {
        "Type" : "AWS::EC2::NetworkInterface",
        "Condition" : "NameValidationPassed",
        "Properties" : {
          "SubnetId" : {"Ref": "SubnetIdHA0" } ,
          "Description" : {"Fn::Join" : [ "-", [ { "Ref" : "AWS::StackName" },"ha0" ] ]},
          "GroupSet" : [ {"Ref" : "SecurityGrpHa0"} ],
          "SourceDestCheck" : "true",
          "Tags" : [ {"Key" : "Name", "Value" : {"Fn::Join" : [ "-", [ { "Ref" : "AWS::StackName" },"ha0" ] ]} }]
        }
      },


      "pktXface0A" : {
        "Type" : "AWS::EC2::NetworkInterface",
        "Condition" : "NameValidationPassed",
        "Properties" : {
          "SubnetId" : {"Ref": "SubnetIdPkt0"} ,
          "Description" : {"Fn::Join" : [ "-", [ { "Ref" : "AWS::StackName" },"pkt0" ] ]},
          "GroupSet" : [ {"Ref" : "SecurityGrpPkt0"} ],
          "SecondaryPrivateIpAddressCount" : {"Ref" : "NumberOfAlternateIPOnPkt0"},
          "SourceDestCheck" : "true",
          "Tags" : [ {"Key" : "Name", "Value" : {"Fn::Join" : [ "-", [ { "Ref" : "AWS::StackName" },"pkt0" ] ]} }]
        }
      },


      "pktXface1A" : {
        "Type" : "AWS::EC2::NetworkInterface",
        "Condition" : "NameValidationPassed",
        "Properties" : {
          "SubnetId" : {"Ref": "SubnetIdPkt1"} ,
          "Description" : {"Fn::Join" : [ "-", [ { "Ref" : "AWS::StackName" },"pkt1" ] ]},
          "GroupSet" : [ {"Ref" : "SecurityGrpPkt1"} ],
          "SecondaryPrivateIpAddressCount" : {"Ref" : "NumberOfAlternateIPOnPkt1"} ,
          "SourceDestCheck" : "true",
          "Tags" : [ {"Key" : "Name", "Value" : {"Fn::Join" : [ "-", [ { "Ref" : "AWS::StackName" },"pkt1" ] ]}}]
        }
      },

      "mgt0EIPActive" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "EipOnMgt",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "mgt0EIPActiveAssocaition" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "EipOnMgt",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "mgt0EIPActive", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "mgtXfaceA"},
          "PrivateIpAddress": { "Fn::GetAtt" : [ "mgtXfaceA" , "PrimaryPrivateIpAddress"]}
        }
      },

      "pkt0EIP01" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt0_01",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt0EIPAssociation01" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt0_01",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt0EIP01", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface0A"},
          "PrivateIpAddress": { "Fn::Select" : [ "0", { "Fn::GetAtt" : [ "pktXface0A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt0EIP02" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt0_02",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt0EIPAssociation02" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt0_02",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt0EIP02", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface0A"},
          "PrivateIpAddress": { "Fn::Select" : [ "1", { "Fn::GetAtt" : [ "pktXface0A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt0EIP03" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt0_03",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt0EIPAssociation03" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt0_03",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt0EIP03", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface0A"},
          "PrivateIpAddress": { "Fn::Select" : [ "2", { "Fn::GetAtt" : [ "pktXface0A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt0EIP04" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt0_04",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt0EIPAssociation04" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt0_04",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt0EIP04", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface0A"},
          "PrivateIpAddress": { "Fn::Select" : [ "3", { "Fn::GetAtt" : [ "pktXface0A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt0EIP05" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt0_05",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt0EIPAssociation05" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt0_05",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt0EIP05", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface0A"},
          "PrivateIpAddress": { "Fn::Select" : [ "4", { "Fn::GetAtt" : [ "pktXface0A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt0EIP06" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt0_06",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt0EIPAssociation06" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt0_06",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt0EIP06", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface0A"},
          "PrivateIpAddress": { "Fn::Select" : [ "5", { "Fn::GetAtt" : [ "pktXface0A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt0EIP07" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt0_07",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt0EIPAssociation07" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt0_07",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt0EIP07", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface0A"},
          "PrivateIpAddress": { "Fn::Select" : [ "6", { "Fn::GetAtt" : [ "pktXface0A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt0EIP08" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt0_08",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt0EIPAssociation08" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt0_08",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt0EIP08", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface0A"},
          "PrivateIpAddress": { "Fn::Select" : [ "7", { "Fn::GetAtt" : [ "pktXface0A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt0EIP09" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt0_09",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt0EIPAssociation09" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt0_09",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt0EIP09", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface0A"},
          "PrivateIpAddress": { "Fn::Select" : [ "8", { "Fn::GetAtt" : [ "pktXface0A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt0EIP10" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt0_10",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt0EIPAssociation10" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt0_10",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt0EIP10", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface0A"},
          "PrivateIpAddress": { "Fn::Select" : [ "9", { "Fn::GetAtt" : [ "pktXface0A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt0EIP11" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt0_11",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt0EIPAssociation11" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt0_11",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt0EIP11", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface0A"},
          "PrivateIpAddress": { "Fn::Select" : [ "10", { "Fn::GetAtt" : [ "pktXface0A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt0EIP12" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt0_12",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt0EIPAssociation12" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt0_12",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt0EIP12", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface0A"},
          "PrivateIpAddress": { "Fn::Select" : [ "11", { "Fn::GetAtt" : [ "pktXface0A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt0EIP13" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt0_13",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt0EIPAssociation13" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt0_13",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt0EIP13", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface0A"},
          "PrivateIpAddress": { "Fn::Select" : [ "12", { "Fn::GetAtt" : [ "pktXface0A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt0EIP14" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt0_14",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt0EIPAssociation14" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt0_14",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt0EIP14", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface0A"},
          "PrivateIpAddress": { "Fn::Select" : [ "13", { "Fn::GetAtt" : [ "pktXface0A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt1EIP01" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt1_01",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt1EIPAssociation01" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt1_01",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt1EIP01", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface1A"},
          "PrivateIpAddress": { "Fn::Select" : [ "0", { "Fn::GetAtt" : [ "pktXface1A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt1EIP02" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt1_02",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt1EIPAssociation02" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt1_02",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt1EIP02", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface1A"},
          "PrivateIpAddress": { "Fn::Select" : [ "1", { "Fn::GetAtt" : [ "pktXface1A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt1EIP03" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt1_03",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt1EIPAssociation03" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt1_03",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt1EIP03", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface1A"},
          "PrivateIpAddress": { "Fn::Select" : [ "2", { "Fn::GetAtt" : [ "pktXface1A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt1EIP04" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt1_04",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt1EIPAssociation04" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt1_04",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt1EIP04", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface1A"},
          "PrivateIpAddress": { "Fn::Select" : [ "3", { "Fn::GetAtt" : [ "pktXface1A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt1EIP05" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt1_05",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt1EIPAssociation05" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt1_05",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt1EIP05", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface1A"},
          "PrivateIpAddress": { "Fn::Select" : [ "4", { "Fn::GetAtt" : [ "pktXface1A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt1EIP06" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt1_06",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt1EIPAssociation06" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt1_06",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt1EIP06", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface1A"},
          "PrivateIpAddress": { "Fn::Select" : [ "5", { "Fn::GetAtt" : [ "pktXface1A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt1EIP07" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt1_07",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt1EIPAssociation07" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt1_07",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt1EIP07", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface1A"},
          "PrivateIpAddress": { "Fn::Select" : [ "6", { "Fn::GetAtt" : [ "pktXface1A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt1EIP08" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt1_08",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt1EIPAssociation08" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt1_08",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt1EIP08", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface1A"},
          "PrivateIpAddress": { "Fn::Select" : [ "7", { "Fn::GetAtt" : [ "pktXface1A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt1EIP09" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt1_09",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt1EIPAssociation09" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt1_09",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt1EIP09", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface1A"},
          "PrivateIpAddress": { "Fn::Select" : [ "8", { "Fn::GetAtt" : [ "pktXface1A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt1EIP10" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt1_10",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt1EIPAssociation10" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt1_10",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt1EIP10", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface1A"},
          "PrivateIpAddress": { "Fn::Select" : [ "9", { "Fn::GetAtt" : [ "pktXface1A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt1EIP11" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt1_11",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt1EIPAssociation11" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt1_11",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt1EIP11", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface1A"},
          "PrivateIpAddress": { "Fn::Select" : [ "10", { "Fn::GetAtt" : [ "pktXface1A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt1EIP12" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt1_12",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt1EIPAssociation12" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt1_12",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt1EIP12", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface1A"},
          "PrivateIpAddress": { "Fn::Select" : [ "11", { "Fn::GetAtt" : [ "pktXface1A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt1EIP13" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt1_13",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt1EIPAssociation13" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt1_13",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt1EIP13", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface1A"},
          "PrivateIpAddress": { "Fn::Select" : [ "12", { "Fn::GetAtt" : [ "pktXface1A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "pkt1EIP14" : {
        "Type" : "AWS::EC2::EIP",
        "Condition" : "AssociateEipOnPkt1_14",
        "Properties" : {
          "Domain" : "vpc"
        }
      },

      "pkt1EIPAssociation14" : {
        "Type" : "AWS::EC2::EIPAssociation",
        "Condition" : "AssociateEipOnPkt1_14",
        "DependsOn": "Ec2InstanceA",
        "Properties": {
          "AllocationId": { "Fn::GetAtt" : [ "pkt1EIP14", "AllocationId" ]},
          "NetworkInterfaceId": {"Ref": "pktXface1A"},
          "PrivateIpAddress": { "Fn::Select" : [ "13", { "Fn::GetAtt" : [ "pktXface1A" , "SecondaryPrivateIpAddresses"]} ] }
        }
      },

      "Ec2InstanceA" : {
        "Type" : "AWS::EC2::Instance",
        "Condition" : "NameValidationPassed",
        "Properties" : {
          "ImageId" : { "Ref" : "AMIID" },
     	  "BlockDeviceMappings" : [ { "DeviceName" : "/dev/sda1", "Ebs" : { "VolumeType": {"Ref": "VolumeType"}, "VolumeSize": {"Ref": "VolumeSize"}, "Iops" : {"Fn::If" : [ "VolumeTypeIO1", {"Ref": "IOPS"}, {"Ref" : "AWS::NoValue"} ]}  , "DeleteOnTermination": "false" } } ],
          "InstanceType" : {"Ref" : "InstanceType"} ,
     	  "Tenancy" : {"Ref" : "Tenancy"}, 
          "PlacementGroupName" : {"Ref" : "PlacementId"}, 
          "EbsOptimized" : "True",
          "Tags" : [ {"Key" : "Name", "Value" : { "Ref" : "AWS::StackName" } } ],
          "KeyName" : { "Ref" : "LinuxAdminSshKey" },
          "NetworkInterfaces" : [ { "NetworkInterfaceId" : { "Ref": "mgtXfaceA"} , "DeviceIndex" : "0" }, { "NetworkInterfaceId" : {"Ref": "haXfaceA"} , "DeviceIndex" : "1" }, { "NetworkInterfaceId" :  {"Ref": "pktXface0A"} , "DeviceIndex" : "2" }, { "NetworkInterfaceId" : {"Ref": "pktXface1A"} , "DeviceIndex" : "3" }],


          "UserData" : { "Fn::Base64" : { "Fn::Join" : [ "", [ "{ \"ReverseNatPkt0\" : \"", { "Ref" : "ReveseNatEnablePkt0" }, "\"",
            ", \"ReverseNatPkt1\"     : \"", { "Ref" : "ReveseNatEnablePkt1" }, "\"",
            ", \"TemplateName\"       : \"AWS_Stand_Alone_template.json\"",
            ", \"TemplateVersion\"    : \"V07.02.00S400\"",
            ", \"CERole\"             : \"", { "Ref" : "CERole" }, "\"",
            ", \"ClusterIp\"          : \"169.254.88.1\"",
            ", \"SbcPersonalityType\" : \"", { "Ref" : "SBCPersonality" } ,"\"",
            ", \"SystemName\"         : \"", { "Ref" : "SystemName" }, "\"",
            ", \"ActiveRoleMgtId\"    : \"", { "Ref" : "mgtXfaceA" }, "\"",
            ", \"CEName\"             : \"", { "Ref" : "InstanceName" }, "\"",
            ", \"AdminSshKey\"        : \"", { "Ref" : "AdminSshKey" }, "\"", 
            ", \"ThirdPartyCpuAlloc\" : \"", { "Ref" : "ThirdPartyCpus" }, "\"",
            ", \"ThirdPartyMemAlloc\" : \"", { "Ref" : "ThirdPartyMem" }, "\" }" ]
            ] }
          }
        }
      }
    },

    "Outputs" : {
      "InstanceIdActive" : {
        "Condition" : "NameValidationPassed",
        "Value" : { "Ref" : "Ec2InstanceA" }
      },

      "DefaultCliAdminPassword" : {
        "Description" : "It is eth0 interface-id of instance which has assigned active role in the template. This is used as default CLI admin password ",
        "Value" : { "Ref" : "mgtXfaceA" }
      },

      "Mgt0InterfaceIDActive" : {
        "Condition" : "NameValidationPassed",
        "Value" : { "Ref" : "mgtXfaceA" }
      },

      "HA0InterfaceIDActive" : {
        "Condition" : "NameValidationPassed",
        "Value" : { "Ref" : "haXfaceA" }
      },

      "Pkt0InterfaceIDActive" : {
        "Condition" : "NameValidationPassed",
        "Value" : { "Ref" : "pktXface0A" }
      },

      "Pkt1InterfaceIDActive" : {
        "Condition" : "NameValidationPassed",
        "Value" : { "Ref" : "pktXface1A" }
      },
      "CeAndSystemNameMatching" : {
        "Condition" : "NameValidationFailed",
        "Value" : "CE Name and System Name are same. ERROR. Not creating any resources."
      }
    }
}
