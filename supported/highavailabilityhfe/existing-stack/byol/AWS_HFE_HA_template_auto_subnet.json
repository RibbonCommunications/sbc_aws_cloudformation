{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "AWS CloudFormation Template to setup and deploy vSBC HA instances and HFE frontend node. This template creates a private subnet for SBC(PKT0) which is served by HFE instance.",
    "Parameters": {
        "AMIID": {
            "Description": "AMI ID of SBC : ami-xxxxxxxx",
            "Type": "AWS::EC2::Image::Id",
            "MaxLength": "21",
            "Default": "ami-3f22b428",
            "AllowedPattern": "ami-[a-z0-9]*",
            "ConstraintDescription": "Must be a valid AMI ID"
        },
        "HFEAMIID": {
            "Description": "AMI ID of HFE Node, select latest AWS Linux 2 AMI ID : ami-xxxxxxxx",
            "Type": "AWS::EC2::Image::Id",
            "MaxLength": "21",
            "Default": "ami-b70554c8",
            "AllowedPattern": "ami-[a-z0-9]*",
            "ConstraintDescription": "Must be a valid HFE Instance AMI ID"
        },
        "HFEScriptS3Location": {
            "Description": "Location of HFE script in S3, see installation guide for more details",
            "Type": "String",
            "MinLength": "1",
            "Default": "s3://haforwarding/HFE.sh",
            "ConstraintDescription": "Must be a valid S3 location"
        },
        "LinuxAdminSshKey": {
            "Description": "Name of an existing EC2 KeyPair to enable SSH access to the SBC and HFE instance via linuxadmin user",
            "Type": "AWS::EC2::KeyPair::KeyName",
            "ConstraintDescription": "must be the name of an existing EC2 KeyPair."
        },
        "AdminSshKey": {
            "Description" : "Enter Public Key to enable SSH access to CLI via admin user",
            "Type": "String",
            "Default" : "ssh-rsa <key>",
            "AllowedPattern" : "ssh-rsa .*",
            "ConstraintDescription" : "Must be a valid public key - Format: ssh-rsa <key>."
        },
        "IAMRole": {
            "Description": "IAM role for instances, check installation guide for more details",
            "Type": "String",
            "MinLength": "1",
            "AllowedPattern": "[a-zA-Z0-9]*"
        },
        "IAMRoleHFE": {
            "Description": "IAM role for HFE instances, check installation guide for more details",
            "Type": "String",
            "MinLength": "1",
            "AllowedPattern": "[a-zA-Z0-9]*"
        },
        "VpcId": {
            "Description": "Select a VPC with four subnets : mgt0, ha0, pkt0 and pkt1",
            "Type": "AWS::EC2::VPC::Id"
        },
        "privateSubnetCIDR": {
            "Description": "Enter a CIDR for pirvate subnet for SBC, this new subnet will be served by HFE instance.",
            "Type": "String",
            "MinLength": "1",
            "Default": "10.54.60.0/24",
            "ConstraintDescription": "Must be a valid CIDR block"
        },
        "privateSubnetAZ": {
            "Description": "Enter Availability Zone for pirvate subnet for SBC, this new subnet will be served by HFE instance. Select AZ which has other subnets for SBC - mgt, HA and Pkt1 ports.",
            "Type": "AWS::EC2::AvailabilityZone::Name"
        },
        "InstanceType": {
            "Description": "EC2 instance type",
            "Type": "String",
            "Default": "m5.xlarge",
            "AllowedValues": [
                "m5.xlarge",
                "m5.2xlarge",
                "c5.2xlarge",
                "c5.4xlarge",
                "c5.9xlarge",
                "c5n.2xlarge",
                "c5n.4xlarge",
                "c5n.9xlarge",
                "p3.2xlarge",
                "g3.4xlarge"
            ],
            "ConstraintDescription": "Must be a valid EC2 instance type."
        },
        "SBCPersonality": {
            "Description": "SBC Personality type, with HFE we support only isbc",
            "Type": "String",
            "Default": "isbc",
            "AllowedValues": [
                "isbc"
            ],
            "ConstraintDescription": "Must be a valid SBC Personality type."
        },
        "ActiveInstanceName": {
            "Description": "CE name of the active instance",
            "Type": "String",
            "Default": "vsbc1",
            "MaxLength": "63",
            "AllowedPattern": "^[A-Za-z]{1}[-A-Za-z0-9.]*[A-Za-z0-9]{1}$",
            "ConstraintDescription": "Enter valid ceName(instance name).  Regex: ^[A-Za-z]{1}[-A-Za-z0-9.]*[A-Za-z0-9]{1}$"
        },
        "StandbyInstanceName": {
            "Description": "CE name of the standby instance",
            "Type": "String",
            "Default": "vsbc2",
            "MaxLength": "63",
            "AllowedPattern": "^[A-Za-z]{1}[-A-Za-z0-9.]*[A-Za-z0-9]{1}$",
            "ConstraintDescription": "Enter valid ceName(instance name).  Regex: ^[A-Za-z]{1}[-A-Za-z0-9.]*[A-Za-z0-9]{1}$"
        },
        "SystemName": {
            "Description": "System Name",
            "Type": "String",
            "Default": "vsbcSystem",
            "MaxLength": "26",
            "AllowedPattern": "^[A-Za-z]{1}[-A-Za-z0-9]*[A-Za-z0-9]{1}$",
            "ConstraintDescription": "Enter valid system name.  Regex: ^[A-Za-z]{1}[-A-Za-z0-9]*[A-Za-z0-9]{1}$ "
        },
        "SecurityGrpMgt0": {
            "Description": "Select security Group for mgt0",
            "Type": "AWS::EC2::SecurityGroup::Id"
        },
        "SecurityGrpHa0": {
            "Description": "Select security Group for ha0",
            "Type": "AWS::EC2::SecurityGroup::Id"
        },
        "SecurityGrpHFEPublic": {
            "Description": "Select security Group for Public interface on HFE",
            "Type": "AWS::EC2::SecurityGroup::Id"
        },
        "SecurityGrpHFETowardsSBC": {
            "Description": "Select security Group for private interface on HFE(towards SBC)",
            "Type": "AWS::EC2::SecurityGroup::Id"
        },
        "SecurityGrpPkt1": {
            "Description": "Select security Group for pkt1",
            "Type": "AWS::EC2::SecurityGroup::Id"
        },
        "SubnetIdMgt0": {
            "Description": "SubnetId of an existing subnet in your Virtual Private Cloud (VPC) for Mgt0",
            "Type": "AWS::EC2::Subnet::Id"
        },
        "SubnetIdHA0": {
            "Description": "SubnetId of an existing subnet in your Virtual Private Cloud (VPC) for HA0",
            "Type": "AWS::EC2::Subnet::Id"
        },
        "SubnetIdPkt1": {
            "Description": "SubnetId of an existing subnet in your Virtual Private Cloud (VPC) for Pkt1",
            "Type": "AWS::EC2::Subnet::Id"
        },
        "SubnetIdHFePublic": {
            "Description": "SubnetId of an existing subnet in your Virtual Private Cloud (VPC) for Public Interface(interface that front-ends SBC) on HFE",
            "Type": "AWS::EC2::Subnet::Id"
        },
        "SubnetIdHFETowardsSBC": {
            "Description": "SubnetId of an existing subnet in your Virtual Private Cloud (VPC) for HFE which will be used to send traffic towards SBC",
            "Type": "AWS::EC2::Subnet::Id"
        },
        "NumberOfAlternateIPOnPkt0": {
            "Description": "Enter the number of IPs required on the SBC PKT0 port and it must be [>= NumberOfSIPOnHFEPublic]. This helps the user to run the private and public calls. For example, if the NumberOfAlternateIPOnPkt0 = 5 and the NumberOfSIPOnHFEPublic = 3, the user can use 3 IPs for the public calls and 2 IPs for the private calls.",
            "Type": "Number",
            "Default": "1",
            "MaxValue": "7",
            "MinValue": "1"
        },
        "NumberOfAlternateIPOnPkt1": {
            "Description": "Enter Number of IPs required on SBC PKT1 port",
            "Type": "Number",
            "Default": "1",
            "MaxValue": "7",
            "MinValue": "1"
        },
        "NumberOfSIPOnHFEPublic": {
            "Description": "Enter the number of EIP(s), which is required to configure the HFE public port. It must be [<= NumberOfAlternateIPOnPkt0] of the SBC. This helps the user to use the maximum [NumberOfAlternateIPOnPkt0] for the public calls. For example, if the NumberOfAlternateIPOnPkt0 = 3 and the NumberOfSIPOnHFEPublic = 5, the HFE configures only 3 IPs for the public calls and the rest 2 IPs are unused.",
            "Type": "Number",
            "Default": "1",
            "MaxValue": "7",
            "MinValue": "1"
        },
        "EipAssociationForMgt": {
            "Description": "Do you want EIP on Management Interface of HFE and SBC? Select Yes if you want to manage HFE and SBC instances using EIP.",
            "Type": "String",
            "Default": "Yes",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "remoteSSHMachinePublicIP": {
            "Description": "Do you want to connect Management Interface of HFE using EIP? Enter IP(public IP) of machine that will connect(SSH) to HFE using public IP",
            "Type": "String",
            "Default": ""
        },
        "Tenancy": {
            "Description": "Tenancy attribute for SBC instances",
            "Type": "String",
            "Default": "default",
            "AllowedValues": [
                "default",
                "dedicated"
            ]
        },
        "PlacementId": {
            "Description": "PlacementGroup to launch SBC instances(Optional)",
            "Type": "String",
            "Default": ""
        },
        "VolumeType": {
            "Description": "Select Type of Volume for SBC",
            "Type": "String",
            "Default": "gp2",
            "AllowedValues": [
                "gp2",
                "io1"
            ]
        },
        "IOPS": {
            "Description": "Enter IOPS reservation for io1 type EBS volume [<= 1950], for gp2 EBS volumes this value is ignored by template.",
            "Type": "Number",
            "Default": "1950",
            "MaxValue": "1950"
        },
        "VolumeSize": {
            "Description": "Enter size of disk in GiB. Minimum disk required is 65 GiB",
            "Type": "Number",
            "Default": "65",
            "MinValue": "65",
            "MaxValue": "1000"
        },
        "SortHfeEip": {
            "Description": "Set True to enable sorting based on HFE EIP.",
            "Type": "String",
            "Default": "True",
            "AllowedValues": [
                "True",
                "False"
            ]
        },
        "AllocateEIPOnHFEPublicInterface": {
            "Description": "Set True to allocate EIPs from Amazon's pool of public IPv4 addresses on HFE public interface or set False to use pre-allocated/reserved EIPs.",
            "Type": "String",
            "Default": "True",
            "AllowedValues": [
                "True",
                "False"
            ]
        },
        "EIPAllocationIdList": {
            "Description": "If [AllocateEIPOnHFEPublicInterface] is set to False then enter comma separated pre-allocated/reserved EIPs allocation IDs and make sure number of EIP allocation IDs are equal to the [NumberOfSIPOnHFEPublic] value. For example, list of EIPs allocation IDs are eipalloc-0f2e0f651bbf494fe,eipalloc-0a9ab9d240705c149,eipalloc-04e59f946b14980b8",
            "Type": "CommaDelimitedList",
            "Default": ""
        },
        "ThirdPartyCpus" : {
            "Description" : "Enter number of CPUs to be reserved for use with third party apps.",
            "Type" : "Number",
            "Default" : "0",
            "MinValue" : "0",
            "MaxValue" : "4"
        },

        "ThirdPartyMem" : {
            "Description" : "Enter how many MB of memory to allow for use with third party apps.",
            "Type" : "Number",
            "Default" : "0",
            "MinValue" : "0",
            "MaxValue" : "4096"
        }
    },
    "Conditions": {
        "MatchingCeNames": {
            "Fn::Equals": [
                {
                    "Ref": "ActiveInstanceName"
                },
                {
                    "Ref": "StandbyInstanceName"
                }
            ]
        },
        "MatchingActiveCeAndSystemName": {
            "Fn::Equals": [
                {
                    "Ref": "SystemName"
                },
                {
                    "Ref": "ActiveInstanceName"
                }
            ]
        },
        "MatchingStandbyCeAndSystemName": {
            "Fn::Equals": [
                {
                    "Ref": "SystemName"
                },
                {
                    "Ref": "StandbyInstanceName"
                }
            ]
        },
        "NameMismatchError": {
            "Fn::Or": [
                {
                    "Condition": "MatchingCeNames"
                },
                {
                    "Condition": "MatchingActiveCeAndSystemName"
                },
                {
                    "Condition": "MatchingStandbyCeAndSystemName"
                }
            ]
        },
        "NameValidationPassed": {
            "Fn::Not": [
                {
                    "Condition": "NameMismatchError"
                }
            ]
        },
        "VolumeTypeIO1": {
            "Fn::Equals": [
                {
                    "Ref": "VolumeType"
                },
                "io1"
            ]
        },
        "EipForMgt": {
            "Fn::Equals": [
                {
                    "Ref": "EipAssociationForMgt"
                },
                "Yes"
            ]
        },
        "AllocateEipOnHfePublic": {
            "Fn::Equals": [
                {
                    "Ref": "AllocateEIPOnHFEPublicInterface"
                },
                "True"
            ]
        },
        "EipOnHfePublic_01": {
            "Fn::Equals": [
                {
                    "Ref": "NumberOfSIPOnHFEPublic"
                },
                "1"
            ]
        },
        "EipOnHfePublic_02": {
            "Fn::Equals": [
                {
                    "Ref": "NumberOfSIPOnHFEPublic"
                },
                "2"
            ]
        },
        "EipOnHfePublic_03": {
            "Fn::Equals": [
                {
                    "Ref": "NumberOfSIPOnHFEPublic"
                },
                "3"
            ]
        },
        "EipOnHfePublic_04": {
            "Fn::Equals": [
                {
                    "Ref": "NumberOfSIPOnHFEPublic"
                },
                "4"
            ]
        },
        "EipOnHfePublic_05": {
            "Fn::Equals": [
                {
                    "Ref": "NumberOfSIPOnHFEPublic"
                },
                "5"
            ]
        },
        "EipOnHfePublic_06": {
            "Fn::Equals": [
                {
                    "Ref": "NumberOfSIPOnHFEPublic"
                },
                "6"
            ]
        },
        "EipOnHfePublic_07": {
            "Fn::Equals": [
                {
                    "Ref": "NumberOfSIPOnHFEPublic"
                },
                "7"
            ]
        },
        "EipOnHfePublic_08": {
            "Fn::Equals": [
                {
                    "Ref": "NumberOfSIPOnHFEPublic"
                },
                "8"
            ]
        },
        "EipOnHfePublic_09": {
            "Fn::Equals": [
                {
                    "Ref": "NumberOfSIPOnHFEPublic"
                },
                "9"
            ]
        },
        "EipOnHfePublic_10": {
            "Fn::Equals": [
                {
                    "Ref": "NumberOfSIPOnHFEPublic"
                },
                "10"
            ]
        },
        "EipOnHfePublic_11": {
            "Fn::Equals": [
                {
                    "Ref": "NumberOfSIPOnHFEPublic"
                },
                "11"
            ]
        },
        "EipOnHfePublic_12": {
            "Fn::Equals": [
                {
                    "Ref": "NumberOfSIPOnHFEPublic"
                },
                "12"
            ]
        },
        "EipOnHfePublic_13": {
            "Fn::Equals": [
                {
                    "Ref": "NumberOfSIPOnHFEPublic"
                },
                "13"
            ]
        },
        "EipOnHfePublic_14": {
            "Fn::Equals": [
                {
                    "Ref": "NumberOfSIPOnHFEPublic"
                },
                "14"
            ]
        },
        "AssociateEipOnHfePublic_01": {
            "Fn::And": [
                {
                    "Fn::Or": [
                        {
                            "Fn::Or": [
                                {
                                    "Condition": "EipOnHfePublic_01"
                                },
                                {
                                    "Condition": "EipOnHfePublic_02"
                                },
                                {
                                    "Condition": "EipOnHfePublic_03"
                                },
                                {
                                    "Condition": "EipOnHfePublic_04"
                                },
                                {
                                    "Condition": "EipOnHfePublic_05"
                                },
                                {
                                    "Condition": "EipOnHfePublic_06"
                                },
                                {
                                    "Condition": "EipOnHfePublic_07"
                                },
                                {
                                    "Condition": "EipOnHfePublic_08"
                                },
                                {
                                    "Condition": "EipOnHfePublic_09"
                                },
                                {
                                    "Condition": "EipOnHfePublic_10"
                                }
                            ]
                        },
                        {
                            "Condition": "EipOnHfePublic_11"
                        },
                        {
                            "Condition": "EipOnHfePublic_12"
                        },
                        {
                            "Condition": "EipOnHfePublic_13"
                        },
                        {
                            "Condition": "EipOnHfePublic_14"
                        }
                    ]
                },
                {
                    "Condition": "NameValidationPassed"
                }
            ]
        },
        "AssociateEipOnHfePublic_02": {
            "Fn::And": [
                {
                    "Fn::Or": [
                        {
                            "Fn::Or": [
                                {
                                    "Condition": "EipOnHfePublic_02"
                                },
                                {
                                    "Condition": "EipOnHfePublic_03"
                                },
                                {
                                    "Condition": "EipOnHfePublic_04"
                                },
                                {
                                    "Condition": "EipOnHfePublic_05"
                                },
                                {
                                    "Condition": "EipOnHfePublic_06"
                                },
                                {
                                    "Condition": "EipOnHfePublic_07"
                                },
                                {
                                    "Condition": "EipOnHfePublic_08"
                                },
                                {
                                    "Condition": "EipOnHfePublic_09"
                                },
                                {
                                    "Condition": "EipOnHfePublic_10"
                                }
                            ]
                        },
                        {
                            "Condition": "EipOnHfePublic_11"
                        },
                        {
                            "Condition": "EipOnHfePublic_12"
                        },
                        {
                            "Condition": "EipOnHfePublic_13"
                        },
                        {
                            "Condition": "EipOnHfePublic_14"
                        }
                    ]
                },
                {
                    "Condition": "NameValidationPassed"
                }
            ]
        },
        "AssociateEipOnHfePublic_03": {
            "Fn::And": [
                {
                    "Fn::Or": [
                        {
                            "Fn::Or": [
                                {
                                    "Condition": "EipOnHfePublic_03"
                                },
                                {
                                    "Condition": "EipOnHfePublic_04"
                                },
                                {
                                    "Condition": "EipOnHfePublic_05"
                                },
                                {
                                    "Condition": "EipOnHfePublic_06"
                                },
                                {
                                    "Condition": "EipOnHfePublic_07"
                                },
                                {
                                    "Condition": "EipOnHfePublic_08"
                                },
                                {
                                    "Condition": "EipOnHfePublic_09"
                                },
                                {
                                    "Condition": "EipOnHfePublic_10"
                                }
                            ]
                        },
                        {
                            "Condition": "EipOnHfePublic_11"
                        },
                        {
                            "Condition": "EipOnHfePublic_12"
                        },
                        {
                            "Condition": "EipOnHfePublic_13"
                        },
                        {
                            "Condition": "EipOnHfePublic_14"
                        }
                    ]
                },
                {
                    "Condition": "NameValidationPassed"
                }
            ]
        },
        "AssociateEipOnHfePublic_04": {
            "Fn::And": [
                {
                    "Fn::Or": [
                        {
                            "Fn::Or": [
                                {
                                    "Condition": "EipOnHfePublic_04"
                                },
                                {
                                    "Condition": "EipOnHfePublic_05"
                                },
                                {
                                    "Condition": "EipOnHfePublic_06"
                                },
                                {
                                    "Condition": "EipOnHfePublic_07"
                                },
                                {
                                    "Condition": "EipOnHfePublic_08"
                                },
                                {
                                    "Condition": "EipOnHfePublic_09"
                                },
                                {
                                    "Condition": "EipOnHfePublic_10"
                                }
                            ]
                        },
                        {
                            "Condition": "EipOnHfePublic_11"
                        },
                        {
                            "Condition": "EipOnHfePublic_12"
                        },
                        {
                            "Condition": "EipOnHfePublic_13"
                        },
                        {
                            "Condition": "EipOnHfePublic_14"
                        }
                    ]
                },
                {
                    "Condition": "NameValidationPassed"
                }
            ]
        },
        "AssociateEipOnHfePublic_05": {
            "Fn::And": [
                {
                    "Fn::Or": [
                        {
                            "Fn::Or": [
                                {
                                    "Condition": "EipOnHfePublic_05"
                                },
                                {
                                    "Condition": "EipOnHfePublic_06"
                                },
                                {
                                    "Condition": "EipOnHfePublic_07"
                                },
                                {
                                    "Condition": "EipOnHfePublic_08"
                                },
                                {
                                    "Condition": "EipOnHfePublic_09"
                                },
                                {
                                    "Condition": "EipOnHfePublic_10"
                                }
                            ]
                        },
                        {
                            "Condition": "EipOnHfePublic_11"
                        },
                        {
                            "Condition": "EipOnHfePublic_12"
                        },
                        {
                            "Condition": "EipOnHfePublic_13"
                        },
                        {
                            "Condition": "EipOnHfePublic_14"
                        }
                    ]
                },
                {
                    "Condition": "NameValidationPassed"
                }
            ]
        },
        "AssociateEipOnHfePublic_06": {
            "Fn::And": [
                {
                    "Fn::Or": [
                        {
                            "Fn::Or": [
                                {
                                    "Condition": "EipOnHfePublic_06"
                                },
                                {
                                    "Condition": "EipOnHfePublic_07"
                                },
                                {
                                    "Condition": "EipOnHfePublic_08"
                                },
                                {
                                    "Condition": "EipOnHfePublic_09"
                                },
                                {
                                    "Condition": "EipOnHfePublic_10"
                                }
                            ]
                        },
                        {
                            "Condition": "EipOnHfePublic_11"
                        },
                        {
                            "Condition": "EipOnHfePublic_12"
                        },
                        {
                            "Condition": "EipOnHfePublic_13"
                        },
                        {
                            "Condition": "EipOnHfePublic_14"
                        }
                    ]
                },
                {
                    "Condition": "NameValidationPassed"
                }
            ]
        },
        "AssociateEipOnHfePublic_07": {
            "Fn::And": [
                {
                    "Fn::Or": [
                        {
                            "Condition": "EipOnHfePublic_07"
                        },
                        {
                            "Condition": "EipOnHfePublic_08"
                        },
                        {
                            "Condition": "EipOnHfePublic_09"
                        },
                        {
                            "Condition": "EipOnHfePublic_10"
                        },
                        {
                            "Condition": "EipOnHfePublic_11"
                        },
                        {
                            "Condition": "EipOnHfePublic_12"
                        },
                        {
                            "Condition": "EipOnHfePublic_13"
                        },
                        {
                            "Condition": "EipOnHfePublic_14"
                        }
                    ]
                },
                {
                    "Condition": "NameValidationPassed"
                }
            ]
        },
        "AssociateEipOnHfePublic_08": {
            "Fn::And": [
                {
                    "Fn::Or": [
                        {
                            "Condition": "EipOnHfePublic_08"
                        },
                        {
                            "Condition": "EipOnHfePublic_09"
                        },
                        {
                            "Condition": "EipOnHfePublic_10"
                        },
                        {
                            "Condition": "EipOnHfePublic_11"
                        },
                        {
                            "Condition": "EipOnHfePublic_12"
                        },
                        {
                            "Condition": "EipOnHfePublic_13"
                        },
                        {
                            "Condition": "EipOnHfePublic_14"
                        }
                    ]
                },
                {
                    "Condition": "NameValidationPassed"
                }
            ]
        },
        "AssociateEipOnHfePublic_09": {
            "Fn::And": [
                {
                    "Fn::Or": [
                        {
                            "Condition": "EipOnHfePublic_09"
                        },
                        {
                            "Condition": "EipOnHfePublic_10"
                        },
                        {
                            "Condition": "EipOnHfePublic_11"
                        },
                        {
                            "Condition": "EipOnHfePublic_12"
                        },
                        {
                            "Condition": "EipOnHfePublic_13"
                        },
                        {
                            "Condition": "EipOnHfePublic_14"
                        }
                    ]
                },
                {
                    "Condition": "NameValidationPassed"
                }
            ]
        },
        "AssociateEipOnHfePublic_10": {
            "Fn::And": [
                {
                    "Fn::Or": [
                        {
                            "Condition": "EipOnHfePublic_10"
                        },
                        {
                            "Condition": "EipOnHfePublic_11"
                        },
                        {
                            "Condition": "EipOnHfePublic_12"
                        },
                        {
                            "Condition": "EipOnHfePublic_13"
                        },
                        {
                            "Condition": "EipOnHfePublic_14"
                        }
                    ]
                },
                {
                    "Condition": "NameValidationPassed"
                }
            ]
        },
        "AssociateEipOnHfePublic_11": {
            "Fn::And": [
                {
                    "Fn::Or": [
                        {
                            "Condition": "EipOnHfePublic_11"
                        },
                        {
                            "Condition": "EipOnHfePublic_12"
                        },
                        {
                            "Condition": "EipOnHfePublic_13"
                        },
                        {
                            "Condition": "EipOnHfePublic_14"
                        }
                    ]
                },
                {
                    "Condition": "NameValidationPassed"
                }
            ]
        },
        "AssociateEipOnHfePublic_12": {
            "Fn::And": [
                {
                    "Fn::Or": [
                        {
                            "Condition": "EipOnHfePublic_12"
                        },
                        {
                            "Condition": "EipOnHfePublic_13"
                        },
                        {
                            "Condition": "EipOnHfePublic_14"
                        }
                    ]
                },
                {
                    "Condition": "NameValidationPassed"
                }
            ]
        },
        "AssociateEipOnHfePublic_13": {
            "Fn::And": [
                {
                    "Fn::Or": [
                        {
                            "Condition": "EipOnHfePublic_13"
                        },
                        {
                            "Condition": "EipOnHfePublic_14"
                        }
                    ]
                },
                {
                    "Condition": "NameValidationPassed"
                }
            ]
        },
        "AssociateEipOnHfePublic_14": {
            "Fn::And": [
                {
                    "Condition": "EipOnHfePublic_14"
                },
                {
                    "Condition": "NameValidationPassed"
                }
            ]
        },
        "AllocateAssociateEipOnHfePublic_01": {
            "Fn::And": [
                {
                    "Condition": "AssociateEipOnHfePublic_01"
                },
                {
                    "Condition": "AllocateEipOnHfePublic"
                }
            ]
        },
        "AllocateAssociateEipOnHfePublic_02": {
            "Fn::And": [
                {
                    "Condition": "AssociateEipOnHfePublic_02"
                },
                {
                    "Condition": "AllocateEipOnHfePublic"
                }
            ]
        },
        "AllocateAssociateEipOnHfePublic_03": {
            "Fn::And": [
                {
                    "Condition": "AssociateEipOnHfePublic_03"
                },
                {
                    "Condition": "AllocateEipOnHfePublic"
                }
            ]
        },
        "AllocateAssociateEipOnHfePublic_04": {
            "Fn::And": [
                {
                    "Condition": "AssociateEipOnHfePublic_04"
                },
                {
                    "Condition": "AllocateEipOnHfePublic"
                }
            ]
        },
        "AllocateAssociateEipOnHfePublic_05": {
            "Fn::And": [
                {
                    "Condition": "AssociateEipOnHfePublic_05"
                },
                {
                    "Condition": "AllocateEipOnHfePublic"
                }
            ]
        },
        "AllocateAssociateEipOnHfePublic_06": {
            "Fn::And": [
                {
                    "Condition": "AssociateEipOnHfePublic_06"
                },
                {
                    "Condition": "AllocateEipOnHfePublic"
                }
            ]
        },
        "AllocateAssociateEipOnHfePublic_07": {
            "Fn::And": [
                {
                    "Condition": "AssociateEipOnHfePublic_07"
                },
                {
                    "Condition": "AllocateEipOnHfePublic"
                }
            ]
        },
        "AllocateAssociateEipOnHfePublic_08": {
            "Fn::And": [
                {
                    "Condition": "AssociateEipOnHfePublic_08"
                },
                {
                    "Condition": "AllocateEipOnHfePublic"
                }
            ]
        },
        "AllocateAssociateEipOnHfePublic_09": {
            "Fn::And": [
                {
                    "Condition": "AssociateEipOnHfePublic_09"
                },
                {
                    "Condition": "AllocateEipOnHfePublic"
                }
            ]
        },
        "AllocateAssociateEipOnHfePublic_10": {
            "Fn::And": [
                {
                    "Condition": "AssociateEipOnHfePublic_10"
                },
                {
                    "Condition": "AllocateEipOnHfePublic"
                }
            ]
        },
        "AllocateAssociateEipOnHfePublic_11": {
            "Fn::And": [
                {
                    "Condition": "AssociateEipOnHfePublic_11"
                },
                {
                    "Condition": "AllocateEipOnHfePublic"
                }
            ]
        },
        "AllocateAssociateEipOnHfePublic_12": {
            "Fn::And": [
                {
                    "Condition": "AssociateEipOnHfePublic_12"
                },
                {
                    "Condition": "AllocateEipOnHfePublic"
                }
            ]
        },
        "AllocateAssociateEipOnHfePublic_13": {
            "Fn::And": [
                {
                    "Condition": "AssociateEipOnHfePublic_13"
                },
                {
                    "Condition": "AllocateEipOnHfePublic"
                }
            ]
        },
        "AllocateAssociateEipOnHfePublic_14": {
            "Fn::And": [
                {
                    "Condition": "AssociateEipOnHfePublic_14"
                },
                {
                    "Condition": "AllocateEipOnHfePublic"
                }
            ]
        }
    },
    "Resources": {
        "mgtXfaceA": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "NameValidationPassed",
            "Properties": {
                "SubnetId": {
                    "Ref": "SubnetIdMgt0"
                },
                "Description": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "SystemName"
                            },
                            "mgt0A"
                        ]
                    ]
                },
                "GroupSet": [
                    {
                        "Ref": "SecurityGrpMgt0"
                    }
                ],
                "SecondaryPrivateIpAddressCount": 1,
                "SourceDestCheck": "true",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "SystemName"
                                    },
                                    "mgt0A"
                                ]
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "707aa6db-298f-4ad3-9852-dff6a57b6117"
                }
            }
        },
        "haXfaceA": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "NameValidationPassed",
            "Properties": {
                "SubnetId": {
                    "Ref": "SubnetIdHA0"
                },
                "Description": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "SystemName"
                            },
                            "ha0A"
                        ]
                    ]
                },
                "GroupSet": [
                    {
                        "Ref": "SecurityGrpHa0"
                    }
                ],
                "SourceDestCheck": "true",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "SystemName"
                                    },
                                    "ha0A"
                                ]
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "51a951cd-ae03-4bff-a603-14f732be91d1"
                }
            }
        },
        "pktXface0A": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "NameValidationPassed",
            "Properties": {
                "SubnetId": {
                    "Ref": "privateSubet"
                },
                "Description": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "SystemName"
                            },
                            "pkt0A"
                        ]
                    ]
                },
                "GroupSet": [
                    {
                        "Ref": "SecurityGrpPkt0"
                    }
                ],
                "SecondaryPrivateIpAddressCount": {
                    "Ref": "NumberOfAlternateIPOnPkt0"
                },
                "SourceDestCheck": "false",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "SystemName"
                                    },
                                    "pkt0A"
                                ]
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "83463436-053b-441a-b7a3-203b0b4d6555"
                }
            }
        },
        "pktXface1A": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "NameValidationPassed",
            "Properties": {
                "SubnetId": {
                    "Ref": "SubnetIdPkt1"
                },
                "Description": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "SystemName"
                            },
                            "pkt1A"
                        ]
                    ]
                },
                "GroupSet": [
                    {
                        "Ref": "SecurityGrpPkt1"
                    }
                ],
                "SecondaryPrivateIpAddressCount": {
                    "Ref": "NumberOfAlternateIPOnPkt1"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "SystemName"
                                    },
                                    "pkt1A"
                                ]
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "30b47652-4e3b-4e80-9241-e372d45af309"
                }
            }
        },
        "mgtXfaceB": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "NameValidationPassed",
            "Properties": {
                "SubnetId": {
                    "Ref": "SubnetIdMgt0"
                },
                "Description": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "SystemName"
                            },
                            "mgt0B"
                        ]
                    ]
                },
                "GroupSet": [
                    {
                        "Ref": "SecurityGrpMgt0"
                    }
                ],
                "SourceDestCheck": "true",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "SystemName"
                                    },
                                    "mgt0B"
                                ]
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "00b911a7-2e7d-4201-9de0-db41c4ccbc0f"
                }
            }
        },
        "haXfaceB": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "NameValidationPassed",
            "Properties": {
                "SubnetId": {
                    "Ref": "SubnetIdHA0"
                },
                "Description": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "SystemName"
                            },
                            "ha0B"
                        ]
                    ]
                },
                "GroupSet": [
                    {
                        "Ref": "SecurityGrpHa0"
                    }
                ],
                "SourceDestCheck": "true",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "SystemName"
                                    },
                                    "ha0B"
                                ]
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "36268cbd-38bd-48ec-a98a-d2b8d92cab21"
                }
            }
        },
        "pktXface0B": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "NameValidationPassed",
            "Properties": {
                "SubnetId": {
                    "Ref": "privateSubet"
                },
                "Description": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "SystemName"
                            },
                            "pkt0B"
                        ]
                    ]
                },
                "GroupSet": [
                    {
                        "Ref": "SecurityGrpPkt0"
                    }
                ],
                "SourceDestCheck": "false",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "SystemName"
                                    },
                                    "pkt0B"
                                ]
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "69dd4dbe-e79a-4dd6-a2c7-a8057eac1a37"
                }
            }
        },
        "pktXface1B": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "NameValidationPassed",
            "Properties": {
                "SubnetId": {
                    "Ref": "SubnetIdPkt1"
                },
                "Description": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "SystemName"
                            },
                            "pkt1B"
                        ]
                    ]
                },
                "GroupSet": [
                    {
                        "Ref": "SecurityGrpPkt1"
                    }
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "SystemName"
                                    },
                                    "pkt1B"
                                ]
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "7cf86ffa-02d6-4532-a19d-e74d02805435"
                }
            }
        },
        "HFEPublic": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "NameValidationPassed",
            "Properties": {
                "SubnetId": {
                    "Ref": "SubnetIdHFePublic"
                },
                "Description": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "SystemName"
                            },
                            "HFE_Public"
                        ]
                    ]
                },
                "GroupSet": [
                    {
                        "Ref": "SecurityGrpHFEPublic"
                    }
                ],
                "SecondaryPrivateIpAddressCount": {
                    "Ref": "NumberOfSIPOnHFEPublic"
                },
                "SourceDestCheck": "true",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "SystemName"
                                    },
                                    "HFE_Public"
                                ]
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "f7fb0f52-ff36-4b59-bc5b-217c387fbc47"
                }
            }
        },
        "HfePublicEIP": {
            "Type": "AWS::EC2::EIP",
            "Condition": "NameValidationPassed",
     	    "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "22430594-e1c3-469c-935c-445008101dda"
                }
            }
        },
        "HfePublicEIPAssociation": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "NameValidationPassed",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::GetAtt": [
                        "HfePublicEIP",
                        "AllocationId"
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEPublic"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "b937381e-0b5e-4899-8f9f-fe3a66be91c4"
                }
            }
        },
        "HfePublicEIP01": {
            "Type": "AWS::EC2::EIP",
            "Condition": "AllocateAssociateEipOnHfePublic_01",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            }
        },
        "HfePublicEIPAssociation01": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "AssociateEipOnHfePublic_01",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::If": [
                        "AllocateEipOnHfePublic",
                        {
                            "Fn::GetAtt": [
                                "HfePublicEIP01",
                                "AllocationId"
                            ]
                        },
                        {
                            "Fn::Select": [
                                "0",
                                {
                                    "Ref": "EIPAllocationIdList"
                                }
                            ]
                        }
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEPublic"
                },
                "PrivateIpAddress": {
                    "Fn::Select": [
                        "0",
                        {
                            "Fn::GetAtt": [
                                "HFEPublic",
                                "SecondaryPrivateIpAddresses"
                            ]
                        }
                    ]
                }
            }
        },
        "HfePublicEIP02": {
            "Type": "AWS::EC2::EIP",
            "Condition": "AllocateAssociateEipOnHfePublic_02",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            }
        },
        "HfePublicEIPAssociation02": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "AssociateEipOnHfePublic_02",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::If": [
                        "AllocateEipOnHfePublic",
                        {
                            "Fn::GetAtt": [
                                "HfePublicEIP02",
                                "AllocationId"
                            ]
                        },
                        {
                            "Fn::Select": [
                                "1",
                                {
                                    "Ref": "EIPAllocationIdList"
                                }
                            ]
                        }
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEPublic"
                },
                "PrivateIpAddress": {
                    "Fn::Select": [
                        "1",
                        {
                            "Fn::GetAtt": [
                                "HFEPublic",
                                "SecondaryPrivateIpAddresses"
                            ]
                        }
                    ]
                }
            }
        },
        "HfePublicEIP03": {
            "Type": "AWS::EC2::EIP",
            "Condition": "AllocateAssociateEipOnHfePublic_03",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            }
        },
        "HfePublicEIPAssociation03": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "AssociateEipOnHfePublic_03",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::If": [
                        "AllocateEipOnHfePublic",
                        {
                            "Fn::GetAtt": [
                                "HfePublicEIP03",
                                "AllocationId"
                            ]
                        },
                        {
                            "Fn::Select": [
                                "2",
                                {
                                    "Ref": "EIPAllocationIdList"
                                }
                            ]
                        }
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEPublic"
                },
                "PrivateIpAddress": {
                    "Fn::Select": [
                        "2",
                        {
                            "Fn::GetAtt": [
                                "HFEPublic",
                                "SecondaryPrivateIpAddresses"
                            ]
                        }
                    ]
                }
            }
        },
        "HfePublicEIP04": {
            "Type": "AWS::EC2::EIP",
            "Condition": "AllocateAssociateEipOnHfePublic_04",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            }
        },
        "HfePublicEIPAssociation04": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "AssociateEipOnHfePublic_04",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::If": [
                        "AllocateEipOnHfePublic",
                        {
                            "Fn::GetAtt": [
                                "HfePublicEIP04",
                                "AllocationId"
                            ]
                        },
                        {
                            "Fn::Select": [
                                "3",
                                {
                                    "Ref": "EIPAllocationIdList"
                                }
                            ]
                        }
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEPublic"
                },
                "PrivateIpAddress": {
                    "Fn::Select": [
                        "3",
                        {
                            "Fn::GetAtt": [
                                "HFEPublic",
                                "SecondaryPrivateIpAddresses"
                            ]
                        }
                    ]
                }
            }
        },
        "HfePublicEIP05": {
            "Type": "AWS::EC2::EIP",
            "Condition": "AllocateAssociateEipOnHfePublic_05",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            }
        },
        "HfePublicEIPAssociation05": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "AssociateEipOnHfePublic_05",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::If": [
                        "AllocateEipOnHfePublic",
                        {
                            "Fn::GetAtt": [
                                "HfePublicEIP05",
                                "AllocationId"
                            ]
                        },
                        {
                            "Fn::Select": [
                                "4",
                                {
                                    "Ref": "EIPAllocationIdList"
                                }
                            ]
                        }
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEPublic"
                },
                "PrivateIpAddress": {
                    "Fn::Select": [
                        "4",
                        {
                            "Fn::GetAtt": [
                                "HFEPublic",
                                "SecondaryPrivateIpAddresses"
                            ]
                        }
                    ]
                }
            }
        },
        "HfePublicEIP06": {
            "Type": "AWS::EC2::EIP",
            "Condition": "AllocateAssociateEipOnHfePublic_06",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            }
        },
        "HfePublicEIPAssociation06": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "AssociateEipOnHfePublic_06",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::If": [
                        "AllocateEipOnHfePublic",
                        {
                            "Fn::GetAtt": [
                                "HfePublicEIP06",
                                "AllocationId"
                            ]
                        },
                        {
                            "Fn::Select": [
                                "5",
                                {
                                    "Ref": "EIPAllocationIdList"
                                }
                            ]
                        }
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEPublic"
                },
                "PrivateIpAddress": {
                    "Fn::Select": [
                        "5",
                        {
                            "Fn::GetAtt": [
                                "HFEPublic",
                                "SecondaryPrivateIpAddresses"
                            ]
                        }
                    ]
                }
            }
        },
        "HfePublicEIP07": {
            "Type": "AWS::EC2::EIP",
            "Condition": "AllocateAssociateEipOnHfePublic_07",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            }
        },
        "HfePublicEIPAssociation07": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "AssociateEipOnHfePublic_07",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::If": [
                        "AllocateEipOnHfePublic",
                        {
                            "Fn::GetAtt": [
                                "HfePublicEIP07",
                                "AllocationId"
                            ]
                        },
                        {
                            "Fn::Select": [
                                "6",
                                {
                                    "Ref": "EIPAllocationIdList"
                                }
                            ]
                        }
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEPublic"
                },
                "PrivateIpAddress": {
                    "Fn::Select": [
                        "6",
                        {
                            "Fn::GetAtt": [
                                "HFEPublic",
                                "SecondaryPrivateIpAddresses"
                            ]
                        }
                    ]
                }
            }
        },
        "HfePublicEIP08": {
            "Type": "AWS::EC2::EIP",
            "Condition": "AllocateAssociateEipOnHfePublic_08",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            }
        },
        "HfePublicEIPAssociation08": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "AssociateEipOnHfePublic_08",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::If": [
                        "AllocateEipOnHfePublic",
                        {
                            "Fn::GetAtt": [
                                "HfePublicEIP08",
                                "AllocationId"
                            ]
                        },
                        {
                            "Fn::Select": [
                                "7",
                                {
                                    "Ref": "EIPAllocationIdList"
                                }
                            ]
                        }
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEPublic"
                },
                "PrivateIpAddress": {
                    "Fn::Select": [
                        "7",
                        {
                            "Fn::GetAtt": [
                                "HFEPublic",
                                "SecondaryPrivateIpAddresses"
                            ]
                        }
                    ]
                }
            }
        },
        "HfePublicEIP09": {
            "Type": "AWS::EC2::EIP",
            "Condition": "AllocateAssociateEipOnHfePublic_09",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            }
        },
        "HfePublicEIPAssociation09": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "AssociateEipOnHfePublic_09",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::If": [
                        "AllocateEipOnHfePublic",
                        {
                            "Fn::GetAtt": [
                                "HfePublicEIP09",
                                "AllocationId"
                            ]
                        },
                        {
                            "Fn::Select": [
                                "8",
                                {
                                    "Ref": "EIPAllocationIdList"
                                }
                            ]
                        }
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEPublic"
                },
                "PrivateIpAddress": {
                    "Fn::Select": [
                        "8",
                        {
                            "Fn::GetAtt": [
                                "HFEPublic",
                                "SecondaryPrivateIpAddresses"
                            ]
                        }
                    ]
                }
            }
        },
        "HfePublicEIP10": {
            "Type": "AWS::EC2::EIP",
            "Condition": "AllocateAssociateEipOnHfePublic_10",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            }
        },
        "HfePublicEIPAssociation10": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "AssociateEipOnHfePublic_10",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::If": [
                        "AllocateEipOnHfePublic",
                        {
                            "Fn::GetAtt": [
                                "HfePublicEIP10",
                                "AllocationId"
                            ]
                        },
                        {
                            "Fn::Select": [
                                "9",
                                {
                                    "Ref": "EIPAllocationIdList"
                                }
                            ]
                        }
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEPublic"
                },
                "PrivateIpAddress": {
                    "Fn::Select": [
                        "9",
                        {
                            "Fn::GetAtt": [
                                "HFEPublic",
                                "SecondaryPrivateIpAddresses"
                            ]
                        }
                    ]
                }
            }
        },
        "HfePublicEIP11": {
            "Type": "AWS::EC2::EIP",
            "Condition": "AllocateAssociateEipOnHfePublic_11",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            }
        },
        "HfePublicEIPAssociation11": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "AssociateEipOnHfePublic_11",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::If": [
                        "AllocateEipOnHfePublic",
                        {
                            "Fn::GetAtt": [
                                "HfePublicEIP11",
                                "AllocationId"
                            ]
                        },
                        {
                            "Fn::Select": [
                                "10",
                                {
                                    "Ref": "EIPAllocationIdList"
                                }
                            ]
                        }
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEPublic"
                },
                "PrivateIpAddress": {
                    "Fn::Select": [
                        "10",
                        {
                            "Fn::GetAtt": [
                                "HFEPublic",
                                "SecondaryPrivateIpAddresses"
                            ]
                        }
                    ]
                }
            }
        },
        "HfePublicEIP12": {
            "Type": "AWS::EC2::EIP",
            "Condition": "AllocateAssociateEipOnHfePublic_12",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            }
        },
        "HfePublicEIPAssociation12": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "AssociateEipOnHfePublic_12",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::If": [
                        "AllocateEipOnHfePublic",
                        {
                            "Fn::GetAtt": [
                                "HfePublicEIP12",
                                "AllocationId"
                            ]
                        },
                        {
                            "Fn::Select": [
                                "11",
                                {
                                    "Ref": "EIPAllocationIdList"
                                }
                            ]
                        }
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEPublic"
                },
                "PrivateIpAddress": {
                    "Fn::Select": [
                        "11",
                        {
                            "Fn::GetAtt": [
                                "HFEPublic",
                                "SecondaryPrivateIpAddresses"
                            ]
                        }
                    ]
                }
            }
        },
        "HfePublicEIP13": {
            "Type": "AWS::EC2::EIP",
            "Condition": "AllocateAssociateEipOnHfePublic_13",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            }
        },
        "HfePublicEIPAssociation13": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "AssociateEipOnHfePublic_13",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::If": [
                        "AllocateEipOnHfePublic",
                        {
                            "Fn::GetAtt": [
                                "HfePublicEIP13",
                                "AllocationId"
                            ]
                        },
                        {
                            "Fn::Select": [
                                "12",
                                {
                                    "Ref": "EIPAllocationIdList"
                                }
                            ]
                        }
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEPublic"
                },
                "PrivateIpAddress": {
                    "Fn::Select": [
                        "12",
                        {
                            "Fn::GetAtt": [
                                "HFEPublic",
                                "SecondaryPrivateIpAddresses"
                            ]
                        }
                    ]
                }
            }
        },
        "HfePublicEIP14": {
            "Type": "AWS::EC2::EIP",
            "Condition": "AllocateAssociateEipOnHfePublic_14",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            }
        },
        "HfePublicEIPAssociation14": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "AssociateEipOnHfePublic_14",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::If": [
                        "AllocateEipOnHfePublic",
                        {
                            "Fn::GetAtt": [
                                "HfePublicEIP14",
                                "AllocationId"
                            ]
                        },
                        {
                            "Fn::Select": [
                                "13",
                                {
                                    "Ref": "EIPAllocationIdList"
                                }
                            ]
                        }
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEPublic"
                },
                "PrivateIpAddress": {
                    "Fn::Select": [
                        "13",
                        {
                            "Fn::GetAtt": [
                                "HFEPublic",
                                "SecondaryPrivateIpAddresses"
                            ]
                        }
                    ]
                }
            }
        },
        "HFEMgt": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "NameValidationPassed",
            "Properties": {
                "SubnetId": {
                    "Ref": "SubnetIdMgt0"
                },
                "Description": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "SystemName"
                            },
                            "HFEMgt"
                        ]
                    ]
                },
                "GroupSet": [
                    {
                        "Ref": "SecurityGrpMgt0"
                    }
                ],
                "SourceDestCheck": "true",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "SystemName"
                                    },
                                    "HFEMgt"
                                ]
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "b4438bd2-827b-4bce-bfe7-bf0c2559588e"
                }
            }
        },
        "HFEPrivate": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "NameValidationPassed",
            "Properties": {
                "SubnetId": {
                    "Ref": "SubnetIdHFETowardsSBC"
                },
                "Description": {
                    "Fn::Join": [
                        "-",
                        [
                            {
                                "Ref": "SystemName"
                            },
                            "HFE_towards_SBC"
                        ]
                    ]
                },
                "GroupSet": [
                    {
                        "Ref": "SecurityGrpHFEPublic"
                    }
                ],
                "SourceDestCheck": "false",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "SystemName"
                                    },
                                    "HFE_towards_SBC"
                                ]
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "f679c8dc-690f-4034-8bfb-2eee03d54a82"
                }
            }
        },
        "privateSubet": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VpcId"
                },
                "CidrBlock": {
                    "Ref": "privateSubnetCIDR"
                },
                "AvailabilityZone": {
                    "Ref": "privateSubnetAZ"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "SystemName"
                                    },
                                    "PrivateSubnet"
                                ]
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "898c2c01-4023-4f19-b920-e0a27ae76685"
                }
            }
        },
        "privateRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VpcId"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "SystemName"
                                    },
                                    "PrivateRouteTable"
                                ]
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "4afd89d8-2cb1-47b0-be81-1ceccb0ab5ec"
                }
            }
        },
        "privateRoute": {
            "Type": "AWS::EC2::Route",
            "DependsOn": "HFEPrivate",
            "Properties": {
                "RouteTableId": {
                    "Ref": "privateRouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "NetworkInterfaceId": {
                    "Ref": "HFEPrivate"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "8a110d6b-32ee-4501-b4d2-c0f46e09627d"
                }
            }
        },
        "privateRouteAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "RouteTableId": {
                    "Ref": "privateRouteTable"
                },
                "SubnetId": {
                    "Ref": "privateSubet"
                }
            }
        },
        "SecurityGrpPkt0": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupDescription": "Security group for pkt0",
                "VpcId": {
                    "Ref": "VpcId"
                },
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "-1",
                        "FromPort": "-1",
                        "ToPort": "-1",
                        "CidrIp": "0.0.0.0/0"
                    }
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "SystemName"
                                    },
                                    "PrivateSubnetPkt0SecurityGroup"
                                ]
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "6e59ae5f-bbe3-449b-b133-fea19279bfdd"
                }
            }
        },
        "mgt0EIPActive": {
            "Type": "AWS::EC2::EIP",
            "Condition": "EipForMgt",
            "Properties": {
                "Domain": "vpc"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "513f2db5-2c59-4102-99aa-5ffd5bfe2508"
                }
            }
        },
        "mgt0EIPActiveAssocaition": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "EipForMgt",
	        "DependsOn": "Ec2InstanceA",
            "Properties": {
                "AllocationId": {
                    "Fn::GetAtt": [
                        "mgt0EIPActive",
                        "AllocationId"
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "mgtXfaceA"
                },
                "PrivateIpAddress": {
                    "Fn::GetAtt": [
                        "mgtXfaceA",
                        "PrimaryPrivateIpAddress"
                    ]
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "c2eac22a-dac3-43e8-a269-655a747809a3"
                }
            }
        },
        "mgt0EIPStandby": {
            "Type": "AWS::EC2::EIP",
            "Condition": "EipForMgt",
            "Properties": {
                "Domain": "vpc"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "072d5305-c1c0-4a9c-afda-2433e6e46df7"
                }
            }
        },
        "mgt0EIPStandbyAssociation": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "EipForMgt",
	        "DependsOn": "Ec2InstanceB",
            "Properties": {
                "AllocationId": {
                    "Fn::GetAtt": [
                        "mgt0EIPStandby",
                        "AllocationId"
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "mgtXfaceB"
                },
                "PrivateIpAddress": {
                    "Fn::GetAtt": [
                        "mgtXfaceB",
                        "PrimaryPrivateIpAddress"
                    ]
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "4e8273a2-eda6-4000-bce9-66101cd18776"
                }
            }
        },
        "HFEMgtEIP": {
            "Type": "AWS::EC2::EIP",
            "Condition": "EipForMgt",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "Domain": "vpc"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "8919dd0f-f859-49c0-a478-259f4c8a4b4e"
                }
            }
        },
        "HFEMgtEIPAssociation": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "EipForMgt",
	        "DependsOn": "Ec2InstanceHFE",
            "Properties": {
                "AllocationId": {
                    "Fn::GetAtt": [
                        "HFEMgtEIP",
                        "AllocationId"
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "HFEMgt"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "a7fbf010-f68d-4cb1-baa0-d65bf17ee79d"
                }
            }
        },
        "mgt0EIPLogical": {
            "Type": "AWS::EC2::EIP",
            "Condition": "EipForMgt",
	        "DependsOn": "Ec2InstanceA",
            "Properties": {
                "Domain": "vpc"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "7017e578-ebf0-497d-998e-e46e5515d284"
                }
            }
        },
        "mgt0EIPLogicalAssocaition": {
            "Type": "AWS::EC2::EIPAssociation",
            "Condition": "EipForMgt",
	        "DependsOn": "Ec2InstanceA",
            "Properties": {
                "AllocationId": {
                    "Fn::GetAtt": [
                        "mgt0EIPLogical",
                        "AllocationId"
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "mgtXfaceA"
                },
                "PrivateIpAddress": {
                    "Fn::Select": [
                        "0",
                        {
                            "Fn::GetAtt": [
                                "mgtXfaceA",
                                "SecondaryPrivateIpAddresses"
                            ]
                        }
                    ]
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "8fdffd5a-b411-458e-9f0c-4504c85d2dcd"
                }
            }
        },
        "Ec2InstanceA": {
            "Type": "AWS::EC2::Instance",
            "Condition": "NameValidationPassed",
            "Properties": {
                "ImageId": {
                    "Ref": "AMIID"
                },
                "IamInstanceProfile": {
                    "Ref": "IAMRole"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sda1",
                        "Ebs": {
                            "VolumeType": {
                                "Ref": "VolumeType"
                            },
                            "VolumeSize": {
                                "Ref": "VolumeSize"
                            },
                            "Iops": {
                                "Fn::If": [
                                    "VolumeTypeIO1",
                                    {
                                        "Ref": "IOPS"
                                    },
                                    {
                                        "Ref": "AWS::NoValue"
                                    }
                                ]
                            },
                            "DeleteOnTermination": "false"
                        }
                    }
                ],
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "Tenancy": {
                    "Ref": "Tenancy"
                },
                "PlacementGroupName": {
                    "Ref": "PlacementId"
                },
                "EbsOptimized": "True",
                "KeyName": {
                    "Ref": "LinuxAdminSshKey"
                },
                "NetworkInterfaces": [
                    {
                        "NetworkInterfaceId": {
                            "Ref": "mgtXfaceA"
                        },
                        "DeviceIndex": "0"
                    },
                    {
                        "NetworkInterfaceId": {
                            "Ref": "haXfaceA"
                        },
                        "DeviceIndex": "1"
                    },
                    {
                        "NetworkInterfaceId": {
                            "Ref": "pktXface0A"
                        },
                        "DeviceIndex": "2"
                    },
                    {
                        "NetworkInterfaceId": {
                            "Ref": "pktXface1A"
                        },
                        "DeviceIndex": "3"
                    }
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "AWS::StackName"
                                    },
                                    "1"
                                ]
                            ]
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "{ \"",
                                "CERole",
                                "\" : \"",
                                "ACTIVE",
                                "\"",
                                ", \"ReverseNatPkt0\"       : \"",
                                "True",
                                "\"",
                                ", \"ReverseNatPkt1\"       : \"",
                                "False",
                                "\"",
                                ", \"SortHfeEip\"             : \"",
                                {
                                    "Ref": "SortHfeEip"
                                },
                                "\"",
                                ", \"IAM_ROLE\"             : \"",
                                {
                                    "Ref": "IAMRole"
                                },
                                "\"",
                                ", \"ALT_Mgt0_00\"          : \"LOGICAL_MGMT_IP\"",
                                ", \"ALT_Pkt0_00\"          : \"VIP1\"",
                                ", \"ALT_Pkt1_00\"          : \"VIP2\"",
                                ", \"ClusterIp\"            : \"",
                                {
                                    "Fn::GetAtt": [
                                        "haXfaceB",
                                        "PrimaryPrivateIpAddress"
                                    ]
                                },
                                "\"",
                                ", \"HFE\"                  : \"",
                                {
                                    "Fn::Select": [
                                        "0",
                                        {
                                            "Fn::GetAtt": [
                                                "HFEPublic",
                                                "SecondaryPrivateIpAddresses"
                                            ]
                                        }
                                    ]
                                },
                                "\"",
                                ", \"SbcPersonalityType\"   : \"",
                                {
                                    "Ref": "SBCPersonality"
                                },
                                "\"",
                                ", \"SbcMgmtMode\"          : \"centralized\"",
                                ", \"TemplateName\"         : \"AWS_HA_template.json\"",
                                ", \"TemplateVersion\"      : \"V07.02.00S400\"",
                                ", \"CEName\"               : \"",
                                {
                                    "Ref": "ActiveInstanceName"
                                },
                                "\"",
                                ", \"PeerCEName\"           : \"",
                                {
                                    "Ref": "StandbyInstanceName"
                                },
                                "\"",
                                ", \"PeerCEHa0IPv4Address\" : \"",
                                {
                                    "Fn::GetAtt": [
                                        "haXfaceB",
                                        "PrimaryPrivateIpAddress"
                                    ]
                                },
                                "\"",
                                ", \"SystemName\"           : \"",
                                {
                                    "Ref": "SystemName"
                                },
                                "\"",
                                ", \"ActiveRoleMgtId\"      : \"",
                                {
                                    "Ref": "mgtXfaceA"
                                },
                                "\"",
                                ", \"NodeName\"             : \"",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "\"",
                                ", \"AdminSshKey\"             : \"",
                                {
                                    "Ref": "AdminSshKey"
                                },
                                "\"",
                                ", \"ThirdPartyCpuAlloc\"   : \"",
                                {
                                    "Ref" : "ThirdPartyCpus"
                                },
                                "\"",
                                ", \"ThirdPartyMemAlloc\"   : \"",
                                {
                                    "Ref" : "ThirdPartyMem"
                                },
                                "\" }"
                            ]
                        ]
                    }
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "ccbc183f-09eb-4dc7-a4d9-0cc3a2ede5e8"
                }
            }
        },
        "Ec2InstanceB": {
            "Type": "AWS::EC2::Instance",
            "Condition": "NameValidationPassed",
            "Properties": {
                "ImageId": {
                    "Ref": "AMIID"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sda1",
                        "Ebs": {
                            "VolumeType": {
                                "Ref": "VolumeType"
                            },
                            "VolumeSize": {
                                "Ref": "VolumeSize"
                            },
                            "Iops": {
                                "Fn::If": [
                                    "VolumeTypeIO1",
                                    {
                                        "Ref": "IOPS"
                                    },
                                    {
                                        "Ref": "AWS::NoValue"
                                    }
                                ]
                            },
                            "DeleteOnTermination": "false"
                        }
                    }
                ],
                "IamInstanceProfile": {
                    "Ref": "IAMRole"
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "Tenancy": {
                    "Ref": "Tenancy"
                },
                "PlacementGroupName": {
                    "Ref": "PlacementId"
                },
                "EbsOptimized": "True",
                "KeyName": {
                    "Ref": "LinuxAdminSshKey"
                },
                "NetworkInterfaces": [
                    {
                        "NetworkInterfaceId": {
                            "Ref": "mgtXfaceB"
                        },
                        "DeviceIndex": "0"
                    },
                    {
                        "NetworkInterfaceId": {
                            "Ref": "haXfaceB"
                        },
                        "DeviceIndex": "1"
                    },
                    {
                        "NetworkInterfaceId": {
                            "Ref": "pktXface0B"
                        },
                        "DeviceIndex": "2"
                    },
                    {
                        "NetworkInterfaceId": {
                            "Ref": "pktXface1B"
                        },
                        "DeviceIndex": "3"
                    }
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "AWS::StackName"
                                    },
                                    "2"
                                ]
                            ]
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "{ \"",
                                "CERole",
                                "\" : \"",
                                "STANDBY",
                                "\"",
                                ", \"ReverseNatPkt0\"       : \"",
                                "True",
                                "\"",
                                ", \"ReverseNatPkt1\"       : \"",
                                "False",
                                "\"",
                                ", \"SortHfeEip\"             : \"",
                                {
                                    "Ref": "SortHfeEip"
                                },
                                "\"",
                                ", \"IAM_ROLE\"             : \"",
                                {
                                    "Ref": "IAMRole"
                                },
                                "\"",
                                ", \"ALT_Mgt0_00\"          : \"LOGICAL_MGMT_IP\"",
                                ", \"ALT_Pkt0_00\"          : \"VIP1\"",
                                ", \"ALT_Pkt1_00\"          : \"VIP2\"",
                                ", \"ClusterIp\"            : \"",
                                {
                                    "Fn::GetAtt": [
                                        "haXfaceA",
                                        "PrimaryPrivateIpAddress"
                                    ]
                                },
                                "\"",
                                ", \"HFE\"                  : \"",
                                {
                                    "Fn::Select": [
                                        "0",
                                        {
                                            "Fn::GetAtt": [
                                                "HFEPublic",
                                                "SecondaryPrivateIpAddresses"
                                            ]
                                        }
                                    ]
                                },
                                "\"",
                                ", \"SbcPersonalityType\"   : \"",
                                {
                                    "Ref": "SBCPersonality"
                                },
                                "\"",
                                ", \"SbcMgmtMode\"          : \"centralized\"",
                                ", \"TemplateName\"         : \"AWS_HA_template.json\"",
                                ", \"TemplateVersion\"      : \"V07.02.00S400\"",
                                ", \"CEName\"               : \"",
                                {
                                    "Ref": "StandbyInstanceName"
                                },
                                "\"",
                                ", \"PeerCEName\"           : \"",
                                {
                                    "Ref": "ActiveInstanceName"
                                },
                                "\"",
                                ", \"PeerCEHa0IPv4Address\" : \"",
                                {
                                    "Fn::GetAtt": [
                                        "haXfaceA",
                                        "PrimaryPrivateIpAddress"
                                    ]
                                },
                                "\"",
                                ", \"SystemName\"           : \"",
                                {
                                    "Ref": "SystemName"
                                },
                                "\"",
                                ", \"ActiveRoleMgtId\"      : \"",
                                {
                                    "Ref": "mgtXfaceA"
                                },
                                "\"",
                                ", \"NodeName\"             : \"",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "\"",
                                ", \"AdminSshKey\"             : \"",
                                {
                                    "Ref": "AdminSshKey"
                                },
                                "\"",
                                ", \"ThirdPartyCpuAlloc\"   : \"",
                                {
                                    "Ref" : "ThirdPartyCpus"
                                },
                                "\"",
                                ", \"ThirdPartyMemAlloc\"   : \"",
                                {
                                    "Ref" : "ThirdPartyMem"
                                },
                                "\" }"
                            ]
                        ]
                    }
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "f70e440b-58bc-4b5e-973b-be57ea5e6f0a"
                }
            }
        },
        "Ec2InstanceHFE": {
            "Type": "AWS::EC2::Instance",
            "Condition": "NameValidationPassed",
            "Properties": {
                "ImageId": {
                    "Ref": "HFEAMIID"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/xvda",
                        "Ebs": {
                            "VolumeType": "gp2",
                            "VolumeSize": "20",
                            "DeleteOnTermination": "false"
                        }
                    }
                ],
                "IamInstanceProfile": {
                    "Ref": "IAMRoleHFE"
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "Tenancy": {
                    "Ref": "Tenancy"
                },
                "PlacementGroupName": {
                    "Ref": "PlacementId"
                },
                "EbsOptimized": "True",
                "KeyName": {
                    "Ref": "LinuxAdminSshKey"
                },
                "NetworkInterfaces": [
                    {
                        "NetworkInterfaceId": {
                            "Ref": "HFEPublic"
                        },
                        "DeviceIndex": "0"
                    },
                    {
                        "NetworkInterfaceId": {
                            "Ref": "HFEMgt"
                        },
                        "DeviceIndex": "1"
                    },
                    {
                        "NetworkInterfaceId": {
                            "Ref": "HFEPrivate"
                        },
                        "DeviceIndex": "2"
                    }
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "-",
                                [
                                    {
                                        "Ref": "AWS::StackName"
                                    },
                                    "HFE"
                                ]
                            ]
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "Content-Type: multipart/mixed; boundary=\"//\"",
                                "\nMIME-Version: 1.0",
                                "\n--//",
                                "\nContent-Type: text/cloud-config; charset=\"us-ascii\"",
                                "\nMIME-Version: 1.0",
                                "\nContent-Transfer-Encoding: 7bit",
                                "\nContent-Disposition: attachment; filename=\"cloud-config.txt\"",
                                "\n#cloud-config",
                                "\ncloud_final_modules:",
                                "\n- [scripts-user, always]",
                                "\n--//",
                                "\nContent-Type: text/x-shellscript; charset=\"us-ascii\"",
                                "\nMIME-Version: 1.0",
                                "\nContent-Transfer-Encoding: 7bit",
                                "\nContent-Disposition: attachment; filename=\"userdata.txt\"",
                                "\n#!/bin/bash",
                                "\nHFE_DIR=\"/home/ec2-user/HFE/\"",
                                "\nHFE_FILE=\"$HFE_DIR/HFE.sh\"",
                                "\nLOG_FILE=\"$HFE_DIR/cloud-init-nat.log\"",
                                "\nNAT_VAR=\"$HFE_DIR/natVars.input\"",
                                "\ntimestamp()",
                                "\n{",
                                "\ndate +\"%Y-%m-%d %T\"",
                                "\n}",
                                "\nif [ ! -d $HFE_DIR ]; then",
                                "\nmkdir -p $HFE_DIR/;",
                                "\nfi;",
                                "\n/bin/echo $(timestamp) \" =========================    cloud-init configuration for HFE    ==========================================\" >> $LOG_FILE",
                                "\nEC2_AVAIL_ZONE=`curl -s http://169.254.169.254/latest/meta-data/placement/availability-zone`",
                                "\nEC2_REGION=\"`echo \"$EC2_AVAIL_ZONE\" | sed 's/[a-z]$//'`\" ",
                                "\naws s3 cp --region $EC2_REGION ",
                                {
                                    "Ref": "HFEScriptS3Location"
                                },
                                " $HFE_FILE",
                                "\nif [ $? -ne 0 ]; then",
                                "\n/bin/echo $(timestamp) \"Error:Could not copy HFE script from S3 bucket.\" >> $LOG_FILE",
                                "\nelse",
                                "\n/bin/echo $(timestamp) \"Copied HFE script from S3 bucket.\" >> $LOG_FILE",
                                "\nfi;",
                                "\n/bin/echo >  $NAT_VAR",
                                "\n/bin/echo \"SBC_SECONDARY_IP=\\\"",
                                {
                                    "Fn::Select": [
                                        "0",
                                        {
                                            "Fn::GetAtt": [
                                                "pktXface0A",
                                                "SecondaryPrivateIpAddresses"
                                            ]
                                        }
                                    ]
                                },
                                "\\\"\" >> $NAT_VAR",
                                "\n/bin/echo \"REMOTE_SSH_MACHINE_IP=\\\"",
                                {
                                    "Fn::If": [
                                        "EipForMgt",
                                        {
                                            "Ref": "remoteSSHMachinePublicIP"
                                        },
                                        ""
                                    ]
                                },
                                "\\\"\">> $NAT_VAR",
                                "\n/bin/echo \"SORT_HFE_EIP=\\\"",
                                {
                                    "Ref": "SortHfeEip"
                                },
                                "\\\"\">> $NAT_VAR",
                                "\n/bin/echo $(timestamp) \"Copied natVars.input\" >> $LOG_FILE",
                                "\nsudo chmod 744 $HFE_FILE",
                                "\nsudo /bin/bash $HFE_FILE setup",
                                "\n/bin/echo \"Configured using HFE script - $HFE_FILE\" >> $LOG_FILE",
                                "\n/bin/echo $(timestamp) \" =========================   Done    ==========================================\" >> $LOG_FILE",
                                "\n--//"
                            ]
                        ]
                    }
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "c25af005-e0a8-4049-b741-a0a10cbeae97"
                }
            }
        }
    },
    "Outputs": {
        "InstanceIdActive": {
            "Condition": "NameValidationPassed",
            "Value": {
                "Ref": "Ec2InstanceA"
            }
        },
        "DefaultCliAdminPassword": {
            "Description": "It is eth0 interface-id of instance which has assigned active role in the template. This is used as default CLI admin password ",
            "Value": {
                "Ref": "mgtXfaceA"
            }
        },
        "Mgt0InterfaceIDActive": {
            "Condition": "NameValidationPassed",
            "Value": {
                "Ref": "mgtXfaceA"
            }
        },
        "HA0InterfaceIDActive": {
            "Condition": "NameValidationPassed",
            "Value": {
                "Ref": "haXfaceA"
            }
        },
        "Pkt0InterfaceIDActive": {
            "Condition": "NameValidationPassed",
            "Value": {
                "Ref": "pktXface0A"
            }
        },
        "Pkt1InterfaceIDActive": {
            "Condition": "NameValidationPassed",
            "Value": {
                "Ref": "pktXface1A"
            }
        },
        "InstanceIdStandby": {
            "Condition": "NameValidationPassed",
            "Value": {
                "Ref": "Ec2InstanceB"
            }
        },
        "Mgt0InterfaceIDStandby": {
            "Condition": "NameValidationPassed",
            "Value": {
                "Ref": "mgtXfaceB"
            }
        },
        "HA0InterfaceIDStandby": {
            "Condition": "NameValidationPassed",
            "Value": {
                "Ref": "haXfaceB"
            }
        },
        "Pkt0InterfaceIDStandby": {
            "Condition": "NameValidationPassed",
            "Value": {
                "Ref": "pktXface0B"
            }
        },
        "Pkt1InterfaceIDStandby": {
            "Condition": "NameValidationPassed",
            "Value": {
                "Ref": "pktXface1B"
            }
        },
        "NameValidationError": {
            "Condition": "NameMismatchError",
            "Value": "Name Validation Failed"
        },
        "ceNamesMatching": {
            "Condition": "MatchingCeNames",
            "Value": "CE Names of Active and Standby are same. ERROR. Not creating any resources."
        },
        "ActiveCeAndSystemNameMatching": {
            "Condition": "MatchingActiveCeAndSystemName",
            "Value": "CE Name of Active and System Name are same. ERROR. Not creating any resources."
        },
        "StandbyCeAndSystemNameMatching": {
            "Condition": "MatchingStandbyCeAndSystemName",
            "Value": "CE Name of Standby and System Name are same. ERROR. Not creating any resources."
        }
    },
    "Metadata": {
        "AWS::CloudFormation::Interface": {
            "ParameterGroups": [
                {
                    "Label": {
                        "default": "SBC and HFE Common Data"
                    },
                    "Parameters": [
                        "LinuxAdminSshKey",
                        "AdminSshKey",
                        "VpcId",
                        "InstanceType",
                        "EipAssociationForMgt",
                        "SortHfeEip",
                        ""
                    ]
                },
                {
                    "Label": {
                        "default": "SBC Configuration"
                    },
                    "Parameters": [
                        "AMIID",
                        "IAMRole",
                        "SBCPersonality",
                        "ActiveInstanceName",
                        "StandbyInstanceName",
                        "SystemName",
                        "SecurityGrpMgt0",
                        "SecurityGrpHa0",
                        "SecurityGrpPkt1",
                        "SubnetIdMgt0",
                        "SubnetIdHA0",
                        "SubnetIdPkt1",
                        "Tenancy",
                        "PlacementId",
                        "VolumeType",
                        "IOPS",
                        "VolumeSize"
                    ]
                },
                {
                    "Label": {
                        "default": "HFE Configuration"
                    },
                    "Parameters": [
                        "HFEAMIID",
                        "HFEScriptS3Location",
                        "IAMRoleHFE",
                        "privateSubnetCIDR",
                        "privateSubnetAZ",
                        "SecurityGrpHFEPublic",
                        "SecurityGrpHFETowardsSBC",
                        "SubnetIdHFePublic",
                        "SubnetIdHFETowardsSBC",
                        "remoteSSHMachinePublicIP"
                    ]
                },
                {
                    "Label": {
                        "default": "IP Configuration on SBC Pkt0, Pkt1 and HFE Public port"
                    },
                    "Parameters": [
                        "NumberOfAlternateIPOnPkt0",
                        "NumberOfAlternateIPOnPkt1",
                        "NumberOfSIPOnHFEPublic",
                        "AllocateEIPOnHFEPublicInterface",
                        "EIPAllocationIdList"
                    ]
                },
                {
                    "Label": {
                        "default": "Third Party Applications Provisioning"
                    },
                    "Parameters": [
                        "ThirdPartyCpus",
                        "ThirdPartyMem"
                    ]
                }
            ]
        },
        "AWS::CloudFormation::Designer": {
            "7017e578-ebf0-497d-998e-e46e5515d284": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 450,
                    "y": 90
                },
                "z": 1,
                "embeds": []
            },
            "8919dd0f-f859-49c0-a478-259f4c8a4b4e": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 570,
                    "y": 90
                },
                "z": 1,
                "embeds": []
            },
            "22430594-e1c3-469c-935c-445008101dda": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 450,
                    "y": 210
                },
                "z": 1,
                "embeds": []
            },
            "072d5305-c1c0-4a9c-afda-2433e6e46df7": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 570,
                    "y": 210
                },
                "z": 1,
                "embeds": []
            },
            "513f2db5-2c59-4102-99aa-5ffd5bfe2508": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 450,
                    "y": 330
                },
                "z": 1,
                "embeds": []
            },
            "6e59ae5f-bbe3-449b-b133-fea19279bfdd": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 570,
                    "y": 330
                },
                "z": 1,
                "embeds": []
            },
            "4afd89d8-2cb1-47b0-be81-1ceccb0ab5ec": {
                "size": {
                    "width": 240,
                    "height": 240
                },
                "position": {
                    "x": 60,
                    "y": 390
                },
                "z": 1,
                "embeds": [
                    "8a110d6b-32ee-4501-b4d2-c0f46e09627d"
                ]
            },
            "898c2c01-4023-4f19-b920-e0a27ae76685": {
                "size": {
                    "width": 330,
                    "height": 240
                },
                "position": {
                    "x": 60,
                    "y": 90
                },
                "z": 1,
                "embeds": [
                    "69dd4dbe-e79a-4dd6-a2c7-a8057eac1a37",
                    "83463436-053b-441a-b7a3-203b0b4d6555"
                ]
            },
            "f679c8dc-690f-4034-8bfb-2eee03d54a82": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 360,
                    "y": 450
                },
                "z": 1,
                "embeds": []
            },
            "8a110d6b-32ee-4501-b4d2-c0f46e09627d": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 90,
                    "y": 450
                },
                "z": 2,
                "parent": "4afd89d8-2cb1-47b0-be81-1ceccb0ab5ec",
                "embeds": [],
                "iscontainedinside": [
                    "4afd89d8-2cb1-47b0-be81-1ceccb0ab5ec"
                ],
                "dependson": [
                    "f679c8dc-690f-4034-8bfb-2eee03d54a82"
                ]
            },
            "b4438bd2-827b-4bce-bfe7-bf0c2559588e": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 480,
                    "y": 450
                },
                "z": 1,
                "embeds": []
            },
            "a7fbf010-f68d-4cb1-baa0-d65bf17ee79d": {
                "source": {
                    "id": "8919dd0f-f859-49c0-a478-259f4c8a4b4e"
                },
                "target": {
                    "id": "b4438bd2-827b-4bce-bfe7-bf0c2559588e"
                }
            },
            "f7fb0f52-ff36-4b59-bc5b-217c387fbc47": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 360,
                    "y": 570
                },
                "z": 1,
                "embeds": []
            },
            "b937381e-0b5e-4899-8f9f-fe3a66be91c4": {
                "source": {
                    "id": "22430594-e1c3-469c-935c-445008101dda"
                },
                "target": {
                    "id": "f7fb0f52-ff36-4b59-bc5b-217c387fbc47"
                }
            },
            "7cf86ffa-02d6-4532-a19d-e74d02805435": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 480,
                    "y": 570
                },
                "z": 1,
                "embeds": []
            },
            "69dd4dbe-e79a-4dd6-a2c7-a8057eac1a37": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 90,
                    "y": 150
                },
                "z": 2,
                "parent": "898c2c01-4023-4f19-b920-e0a27ae76685",
                "embeds": [],
                "isassociatedwith": [
                    "6e59ae5f-bbe3-449b-b133-fea19279bfdd"
                ],
                "iscontainedinside": [
                    "898c2c01-4023-4f19-b920-e0a27ae76685"
                ]
            },
            "36268cbd-38bd-48ec-a98a-d2b8d92cab21": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 600,
                    "y": 450
                },
                "z": 1,
                "embeds": []
            },
            "00b911a7-2e7d-4201-9de0-db41c4ccbc0f": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 600,
                    "y": 570
                },
                "z": 1,
                "embeds": []
            },
            "4e8273a2-eda6-4000-bce9-66101cd18776": {
                "source": {
                    "id": "072d5305-c1c0-4a9c-afda-2433e6e46df7"
                },
                "target": {
                    "id": "00b911a7-2e7d-4201-9de0-db41c4ccbc0f"
                }
            },
            "30b47652-4e3b-4e80-9241-e372d45af309": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 690,
                    "y": 90
                },
                "z": 1,
                "embeds": []
            },
            "83463436-053b-441a-b7a3-203b0b4d6555": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 210,
                    "y": 150
                },
                "z": 2,
                "parent": "898c2c01-4023-4f19-b920-e0a27ae76685",
                "embeds": [],
                "isassociatedwith": [
                    "6e59ae5f-bbe3-449b-b133-fea19279bfdd"
                ],
                "iscontainedinside": [
                    "898c2c01-4023-4f19-b920-e0a27ae76685"
                ]
            },
            "c25af005-e0a8-4049-b741-a0a10cbeae97": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 690,
                    "y": 210
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "f7fb0f52-ff36-4b59-bc5b-217c387fbc47",
                    "b4438bd2-827b-4bce-bfe7-bf0c2559588e",
                    "f679c8dc-690f-4034-8bfb-2eee03d54a82"
                ]
            },
            "51a951cd-ae03-4bff-a603-14f732be91d1": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 690,
                    "y": 330
                },
                "z": 1,
                "embeds": []
            },
            "707aa6db-298f-4ad3-9852-dff6a57b6117": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 720,
                    "y": 450
                },
                "z": 1,
                "embeds": []
            },
            "f70e440b-58bc-4b5e-973b-be57ea5e6f0a": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 720,
                    "y": 570
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "00b911a7-2e7d-4201-9de0-db41c4ccbc0f",
                    "36268cbd-38bd-48ec-a98a-d2b8d92cab21",
                    "69dd4dbe-e79a-4dd6-a2c7-a8057eac1a37",
                    "7cf86ffa-02d6-4532-a19d-e74d02805435"
                ]
            },
            "ccbc183f-09eb-4dc7-a4d9-0cc3a2ede5e8": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 690
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "707aa6db-298f-4ad3-9852-dff6a57b6117",
                    "51a951cd-ae03-4bff-a603-14f732be91d1",
                    "83463436-053b-441a-b7a3-203b0b4d6555",
                    "30b47652-4e3b-4e80-9241-e372d45af309"
                ]
            },
            "8fdffd5a-b411-458e-9f0c-4504c85d2dcd": {
                "source": {
                    "id": "7017e578-ebf0-497d-998e-e46e5515d284"
                },
                "target": {
                    "id": "707aa6db-298f-4ad3-9852-dff6a57b6117"
                }
            },
            "c2eac22a-dac3-43e8-a269-655a747809a3": {
                "source": {
                    "id": "513f2db5-2c59-4102-99aa-5ffd5bfe2508"
                },
                "target": {
                    "id": "707aa6db-298f-4ad3-9852-dff6a57b6117"
                }
            }
        }
    }
}
